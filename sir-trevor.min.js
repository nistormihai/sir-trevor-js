/*!
 * Sir Trevor JS v0.4.0
 *
 * Released under the MIT license
 * www.opensource.org/licenses/MIT
 *
 * 2014-12-16
 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.SirTrevor=e()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){module.exports=require("./src/")},{"./src/":173}],2:[function(require,module,exports){(function(process){!function(root,factory){"function"==typeof define&&define.amd?define(factory):"object"==typeof exports?module.exports=factory():root.returnExports=factory()}(this,function(){"use strict";var ArrayIterator,isCallableWithoutNew=function(func){try{func()}catch(e){return!1}return!0},supportsSubclassing=function(C,f){try{var Sub=function(){C.apply(this,arguments)};return Sub.__proto__?(Object.setPrototypeOf(Sub,C),Sub.prototype=Object.create(C.prototype,{constructor:{value:C}}),f(Sub)):!1}catch(e){return!1}},arePropertyDescriptorsSupported=function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}},startsWithRejectsRegex=function(){var rejectsRegex=!1;if(String.prototype.startsWith)try{"/a/".startsWith(/a/)}catch(e){rejectsRegex=!0}return rejectsRegex},getGlobal=new Function("return this;"),globals=getGlobal(),global_isFinite=globals.isFinite,supportsDescriptors=!!Object.defineProperty&&arePropertyDescriptorsSupported(),startsWithIsCompliant=startsWithRejectsRegex(),_indexOf=(Array.prototype.slice,Function.call.bind(String.prototype.indexOf)),_toString=Function.call.bind(Object.prototype.toString),_hasOwnProperty=Function.call.bind(Object.prototype.hasOwnProperty),Symbol=globals.Symbol||{},Type={string:function(x){return"[object String]"===_toString(x)},regex:function(x){return"[object RegExp]"===_toString(x)},symbol:function(x){return"function"==typeof globals.Symbol&&"symbol"==typeof x}},defineProperty=function(object,name,value,force){!force&&name in object||(supportsDescriptors?Object.defineProperty(object,name,{configurable:!0,enumerable:!1,writable:!0,value:value}):object[name]=value)},defineProperties=function(object,map){Object.keys(map).forEach(function(name){var method=map[name];defineProperty(object,name,method,!1)})},create=Object.create||function(prototype,properties){function Type(){}Type.prototype=prototype;var object=new Type;return"undefined"!=typeof properties&&defineProperties(object,properties),object},$iterator$=Type.symbol(Symbol.iterator)?Symbol.iterator:"_es6-shim iterator_";globals.Set&&"function"==typeof(new globals.Set)["@@iterator"]&&($iterator$="@@iterator");var addIterator=function(prototype,impl){impl||(impl=function(){return this});var o={};o[$iterator$]=impl,defineProperties(prototype,o),!prototype[$iterator$]&&Type.symbol($iterator$)&&(prototype[$iterator$]=impl)},isArguments=function(value){var str=_toString(value),result="[object Arguments]"===str;return result||(result="[object Array]"!==str&&null!==value&&"object"==typeof value&&"number"==typeof value.length&&value.length>=0&&"[object Function]"===_toString(value.callee)),result},emulateES6construct=function(o){if(!ES.TypeIsObject(o))throw new TypeError("bad object");return o._es6construct||(o.constructor&&ES.IsCallable(o.constructor["@@create"])&&(o=o.constructor["@@create"](o)),defineProperties(o,{_es6construct:!0})),o},ES={CheckObjectCoercible:function(x,optMessage){if(null==x)throw new TypeError(optMessage||"Cannot call method on "+x);return x},TypeIsObject:function(x){return null!=x&&Object(x)===x},ToObject:function(o,optMessage){return Object(ES.CheckObjectCoercible(o,optMessage))},IsCallable:function(x){return"function"==typeof x&&"[object Function]"===_toString(x)},ToInt32:function(x){return x>>0},ToUint32:function(x){return x>>>0},ToInteger:function(value){var number=+value;return Number.isNaN(number)?0:0!==number&&Number.isFinite(number)?(number>0?1:-1)*Math.floor(Math.abs(number)):number},ToLength:function(value){var len=ES.ToInteger(value);return 0>=len?0:len>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:len},SameValue:function(a,b){return a===b?0===a?1/a===1/b:!0:Number.isNaN(a)&&Number.isNaN(b)},SameValueZero:function(a,b){return a===b||Number.isNaN(a)&&Number.isNaN(b)},IsIterable:function(o){return ES.TypeIsObject(o)&&("undefined"!=typeof o[$iterator$]||isArguments(o))},GetIterator:function(o){if(isArguments(o))return new ArrayIterator(o,"value");var itFn=o[$iterator$];if(!ES.IsCallable(itFn))throw new TypeError("value is not an iterable");var it=itFn.call(o);if(!ES.TypeIsObject(it))throw new TypeError("bad iterator");return it},IteratorNext:function(it){var result=arguments.length>1?it.next(arguments[1]):it.next();if(!ES.TypeIsObject(result))throw new TypeError("bad iterator");return result},Construct:function(C,args){var obj;obj=ES.IsCallable(C["@@create"])?C["@@create"]():create(C.prototype||null),defineProperties(obj,{_es6construct:!0});var result=C.apply(obj,args);return ES.TypeIsObject(result)?result:obj}},numberConversion=function(){function roundToEven(n){var w=Math.floor(n),f=n-w;return.5>f?w:f>.5?w+1:w%2?w+1:w}function packIEEE754(v,ebits,fbits){var s,e,f,i,bits,str,bytes,bias=(1<<ebits-1)-1;for(v!==v?(e=(1<<ebits)-1,f=Math.pow(2,fbits-1),s=0):1/0===v||v===-1/0?(e=(1<<ebits)-1,f=0,s=0>v?1:0):0===v?(e=0,f=0,s=1/v===-1/0?1:0):(s=0>v,v=Math.abs(v),v>=Math.pow(2,1-bias)?(e=Math.min(Math.floor(Math.log(v)/Math.LN2),1023),f=roundToEven(v/Math.pow(2,e)*Math.pow(2,fbits)),f/Math.pow(2,fbits)>=2&&(e+=1,f=1),e>bias?(e=(1<<ebits)-1,f=0):(e+=bias,f-=Math.pow(2,fbits))):(e=0,f=roundToEven(v/Math.pow(2,1-bias-fbits)))),bits=[],i=fbits;i;i-=1)bits.push(f%2?1:0),f=Math.floor(f/2);for(i=ebits;i;i-=1)bits.push(e%2?1:0),e=Math.floor(e/2);for(bits.push(s?1:0),bits.reverse(),str=bits.join(""),bytes=[];str.length;)bytes.push(parseInt(str.slice(0,8),2)),str=str.slice(8);return bytes}function unpackIEEE754(bytes,ebits,fbits){var i,j,b,str,bias,s,e,f,bits=[];for(i=bytes.length;i;i-=1)for(b=bytes[i-1],j=8;j;j-=1)bits.push(b%2?1:0),b>>=1;return bits.reverse(),str=bits.join(""),bias=(1<<ebits-1)-1,s=parseInt(str.slice(0,1),2)?-1:1,e=parseInt(str.slice(1,1+ebits),2),f=parseInt(str.slice(1+ebits),2),e===(1<<ebits)-1?0!==f?0/0:1/0*s:e>0?s*Math.pow(2,e-bias)*(1+f/Math.pow(2,fbits)):0!==f?s*Math.pow(2,-(bias-1))*(f/Math.pow(2,fbits)):0>s?-0:0}function unpackFloat32(b){return unpackIEEE754(b,8,23)}function packFloat32(v){return packIEEE754(v,8,23)}var conversions={toFloat32:function(num){return unpackFloat32(packFloat32(num))}};if("undefined"!=typeof Float32Array){var float32array=new Float32Array(1);conversions.toFloat32=function(num){return float32array[0]=num,float32array[0]}}return conversions}();if(defineProperties(String,{fromCodePoint:function(){for(var next,result=[],i=0,length=arguments.length;length>i;i++){if(next=Number(arguments[i]),!ES.SameValue(next,ES.ToInteger(next))||0>next||next>1114111)throw new RangeError("Invalid code point "+next);65536>next?result.push(String.fromCharCode(next)):(next-=65536,result.push(String.fromCharCode((next>>10)+55296)),result.push(String.fromCharCode(next%1024+56320)))}return result.join("")},raw:function(callSite){var cooked=ES.ToObject(callSite,"bad callSite"),rawValue=cooked.raw,rawString=ES.ToObject(rawValue,"bad raw value"),len=rawString.length,literalsegments=ES.ToLength(len);if(0>=literalsegments)return"";for(var nextKey,next,nextSeg,nextSub,stringElements=[],nextIndex=0;literalsegments>nextIndex&&(nextKey=String(nextIndex),next=rawString[nextKey],nextSeg=String(next),stringElements.push(nextSeg),!(nextIndex+1>=literalsegments));)next=nextIndex+1<arguments.length?arguments[nextIndex+1]:"",nextSub=String(next),stringElements.push(nextSub),nextIndex++;return stringElements.join("")}}),1!==String.fromCodePoint.length){var originalFromCodePoint=Function.apply.bind(String.fromCodePoint);defineProperty(String,"fromCodePoint",function(){return originalFromCodePoint(this,arguments)},!0)}var StringShims={repeat:function(){var repeat=function(s,times){if(1>times)return"";if(times%2)return repeat(s,times-1)+s;var half=repeat(s,times/2);return half+half};return function(times){var thisStr=String(ES.CheckObjectCoercible(this));if(times=ES.ToInteger(times),0>times||1/0===times)throw new RangeError("Invalid String#repeat value");return repeat(thisStr,times)}}(),startsWith:function(searchStr){var thisStr=String(ES.CheckObjectCoercible(this));if(Type.regex(searchStr))throw new TypeError('Cannot call method "startsWith" with a regex');searchStr=String(searchStr);var startArg=arguments.length>1?arguments[1]:void 0,start=Math.max(ES.ToInteger(startArg),0);return thisStr.slice(start,start+searchStr.length)===searchStr},endsWith:function(searchStr){var thisStr=String(ES.CheckObjectCoercible(this));if(Type.regex(searchStr))throw new TypeError('Cannot call method "endsWith" with a regex');searchStr=String(searchStr);var thisLen=thisStr.length,posArg=arguments.length>1?arguments[1]:void 0,pos="undefined"==typeof posArg?thisLen:ES.ToInteger(posArg),end=Math.min(Math.max(pos,0),thisLen);return thisStr.slice(end-searchStr.length,end)===searchStr},includes:function(searchString){var position=arguments.length>1?arguments[1]:void 0;return-1!==_indexOf(this,searchString,position)},codePointAt:function(pos){var thisStr=String(ES.CheckObjectCoercible(this)),position=ES.ToInteger(pos),length=thisStr.length;if(!(0>position||position>=length)){var first=thisStr.charCodeAt(position),isEnd=position+1===length;if(55296>first||first>56319||isEnd)return first;var second=thisStr.charCodeAt(position+1);return 56320>second||second>57343?first:1024*(first-55296)+(second-56320)+65536}}};defineProperties(String.prototype,StringShims);var hasStringTrimBug=1!=="".trim().length;if(hasStringTrimBug){{String.prototype.trim}delete String.prototype.trim;var ws=["	\n\f\r   ᠎    ","         　\u2028","\u2029﻿"].join(""),trimRegexp=new RegExp("(^["+ws+"]+)|(["+ws+"]+$)","g");defineProperties(String.prototype,{trim:function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(trimRegexp,"")}})}var StringIterator=function(s){this._s=String(ES.CheckObjectCoercible(s)),this._i=0};StringIterator.prototype.next=function(){var s=this._s,i=this._i;if("undefined"==typeof s||i>=s.length)return this._s=void 0,{value:void 0,done:!0};var second,len,first=s.charCodeAt(i);return 55296>first||first>56319||i+1==s.length?len=1:(second=s.charCodeAt(i+1),len=56320>second||second>57343?1:2),this._i=i+len,{value:s.substr(i,len),done:!1}},addIterator(StringIterator.prototype),addIterator(String.prototype,function(){return new StringIterator(this)}),startsWithIsCompliant||defineProperties(String.prototype,{startsWith:StringShims.startsWith,endsWith:StringShims.endsWith});var ArrayShims={from:function(iterable){var mapFn=arguments.length>1?arguments[1]:void 0,list=ES.ToObject(iterable,"bad iterable");if("undefined"!=typeof mapFn&&!ES.IsCallable(mapFn))throw new TypeError("Array.from: when provided, the second argument must be a function");var length,result,i,value,hasThisArg=arguments.length>2,thisArg=hasThisArg?arguments[2]:void 0,usingIterator=ES.IsIterable(list);if(usingIterator){i=0,result=ES.IsCallable(this)?Object(new this):[];var iterationValue,it=usingIterator?ES.GetIterator(list):null;do iterationValue=ES.IteratorNext(it),iterationValue.done||(value=iterationValue.value,result[i]=mapFn?hasThisArg?mapFn.call(thisArg,value,i):mapFn(value,i):value,i+=1);while(!iterationValue.done);length=i}else for(length=ES.ToLength(list.length),result=ES.IsCallable(this)?Object(new this(length)):new Array(length),i=0;length>i;++i)value=list[i],result[i]=mapFn?hasThisArg?mapFn.call(thisArg,value,i):mapFn(value,i):value;return result.length=length,result},of:function(){return Array.from(arguments)}};defineProperties(Array,ArrayShims);var arrayFromSwallowsNegativeLengths=function(){try{return 0===Array.from({length:-1}).length}catch(e){return!1}};arrayFromSwallowsNegativeLengths()||defineProperty(Array,"from",ArrayShims.from,!0),ArrayIterator=function(array,kind){this.i=0,this.array=array,this.kind=kind},defineProperties(ArrayIterator.prototype,{next:function(){var i=this.i,array=this.array;if(!(this instanceof ArrayIterator))throw new TypeError("Not an ArrayIterator");if("undefined"!=typeof array)for(var len=ES.ToLength(array.length);len>i;i++){var retval,kind=this.kind;return"key"===kind?retval=i:"value"===kind?retval=array[i]:"entry"===kind&&(retval=[i,array[i]]),this.i=i+1,{value:retval,done:!1}}return this.array=void 0,{value:void 0,done:!0}}}),addIterator(ArrayIterator.prototype);var ArrayPrototypeShims={copyWithin:function(target,start){var end=arguments[2],o=ES.ToObject(this),len=ES.ToLength(o.length);target=ES.ToInteger(target),start=ES.ToInteger(start);var to=0>target?Math.max(len+target,0):Math.min(target,len),from=0>start?Math.max(len+start,0):Math.min(start,len);end="undefined"==typeof end?len:ES.ToInteger(end);var fin=0>end?Math.max(len+end,0):Math.min(end,len),count=Math.min(fin-from,len-to),direction=1;for(to>from&&from+count>to&&(direction=-1,from+=count-1,to+=count-1);count>0;)_hasOwnProperty(o,from)?o[to]=o[from]:delete o[from],from+=direction,to+=direction,count-=1;return o},fill:function(value){var start=arguments.length>1?arguments[1]:void 0,end=arguments.length>2?arguments[2]:void 0,O=ES.ToObject(this),len=ES.ToLength(O.length);start=ES.ToInteger("undefined"==typeof start?0:start),end=ES.ToInteger("undefined"==typeof end?len:end);for(var relativeStart=0>start?Math.max(len+start,0):Math.min(start,len),relativeEnd=0>end?len+end:end,i=relativeStart;len>i&&relativeEnd>i;++i)O[i]=value;return O},find:function(predicate){var list=ES.ToObject(this),length=ES.ToLength(list.length);if(!ES.IsCallable(predicate))throw new TypeError("Array#find: predicate must be a function");for(var value,thisArg=arguments.length>1?arguments[1]:null,i=0;length>i;i++)if(value=list[i],thisArg){if(predicate.call(thisArg,value,i,list))return value}else if(predicate(value,i,list))return value},findIndex:function(predicate){var list=ES.ToObject(this),length=ES.ToLength(list.length);if(!ES.IsCallable(predicate))throw new TypeError("Array#findIndex: predicate must be a function");for(var thisArg=arguments.length>1?arguments[1]:null,i=0;length>i;i++)if(thisArg){if(predicate.call(thisArg,list[i],i,list))return i}else if(predicate(list[i],i,list))return i;return-1},keys:function(){return new ArrayIterator(this,"key")},values:function(){return new ArrayIterator(this,"value")},entries:function(){return new ArrayIterator(this,"entry")}};Array.prototype.keys&&!ES.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!ES.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[$iterator$]&&(defineProperties(Array.prototype,{values:Array.prototype[$iterator$]}),Type.symbol(Symbol.unscopables)&&(Array.prototype[Symbol.unscopables].values=!0)),defineProperties(Array.prototype,ArrayPrototypeShims),addIterator(Array.prototype,function(){return this.values()}),Object.getPrototypeOf&&addIterator(Object.getPrototypeOf([].values()));var maxSafeInteger=Math.pow(2,53)-1;defineProperties(Number,{MAX_SAFE_INTEGER:maxSafeInteger,MIN_SAFE_INTEGER:-maxSafeInteger,EPSILON:2.220446049250313e-16,parseInt:globals.parseInt,parseFloat:globals.parseFloat,isFinite:function(value){return"number"==typeof value&&global_isFinite(value)},isInteger:function(value){return Number.isFinite(value)&&ES.ToInteger(value)===value},isSafeInteger:function(value){return Number.isInteger(value)&&Math.abs(value)<=Number.MAX_SAFE_INTEGER},isNaN:function(value){return value!==value}}),[,1].find(function(item,idx){return 0===idx})||defineProperty(Array.prototype,"find",ArrayPrototypeShims.find,!0),0!==[,1].findIndex(function(item,idx){return 0===idx})&&defineProperty(Array.prototype,"findIndex",ArrayPrototypeShims.findIndex,!0),supportsDescriptors&&(defineProperties(Object,{getPropertyDescriptor:function(subject,name){for(var pd=Object.getOwnPropertyDescriptor(subject,name),proto=Object.getPrototypeOf(subject);"undefined"==typeof pd&&null!==proto;)pd=Object.getOwnPropertyDescriptor(proto,name),proto=Object.getPrototypeOf(proto);return pd},getPropertyNames:function(subject){for(var result=Object.getOwnPropertyNames(subject),proto=Object.getPrototypeOf(subject),addProperty=function(property){-1===result.indexOf(property)&&result.push(property)};null!==proto;)Object.getOwnPropertyNames(proto).forEach(addProperty),proto=Object.getPrototypeOf(proto);return result}}),defineProperties(Object,{assign:function(target){if(!ES.TypeIsObject(target))throw new TypeError("target must be an object");return Array.prototype.reduce.call(arguments,function(target,source){return Object.keys(Object(source)).reduce(function(target,key){return target[key]=source[key],target},target)})},is:function(a,b){return ES.SameValue(a,b)},setPrototypeOf:function(Object,magic){var set,checkArgs=function(O,proto){if(!ES.TypeIsObject(O))throw new TypeError("cannot set prototype on a non-object");if(null!==proto&&!ES.TypeIsObject(proto))throw new TypeError("can only set prototype to an object or null"+proto)},setPrototypeOf=function(O,proto){return checkArgs(O,proto),set.call(O,proto),O};try{set=Object.getOwnPropertyDescriptor(Object.prototype,magic).set,set.call({},null)}catch(e){if(Object.prototype!=={}[magic])return;set=function(proto){this[magic]=proto},setPrototypeOf.polyfill=setPrototypeOf(setPrototypeOf({},null),Object.prototype)instanceof Object}return setPrototypeOf}(Object,"__proto__")})),Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&!function(){var FAKENULL=Object.create(null),gpo=Object.getPrototypeOf,spo=Object.setPrototypeOf;Object.getPrototypeOf=function(o){var result=gpo(o);return result===FAKENULL?null:result},Object.setPrototypeOf=function(o,p){return null===p&&(p=FAKENULL),spo(o,p)},Object.setPrototypeOf.polyfill=!1}();try{Object.keys("foo")}catch(e){var originalObjectKeys=Object.keys;Object.keys=function(obj){return originalObjectKeys(ES.ToObject(obj))}}var MathShims={acosh:function(value){return value=Number(value),Number.isNaN(value)||1>value?0/0:1===value?0:1/0===value?value:Math.log(value+Math.sqrt(value*value-1))},asinh:function(value){return value=Number(value),0!==value&&global_isFinite(value)?0>value?-Math.asinh(-value):Math.log(value+Math.sqrt(value*value+1)):value},atanh:function(value){return value=Number(value),Number.isNaN(value)||-1>value||value>1?0/0:-1===value?-1/0:1===value?1/0:0===value?value:.5*Math.log((1+value)/(1-value))},cbrt:function(value){if(value=Number(value),0===value)return value;var result,negate=0>value;return negate&&(value=-value),result=Math.pow(value,1/3),negate?-result:result},clz32:function(value){value=Number(value);var number=ES.ToUint32(value);return 0===number?32:32-number.toString(2).length},cosh:function(value){return value=Number(value),0===value?1:Number.isNaN(value)?0/0:global_isFinite(value)?(0>value&&(value=-value),value>21?Math.exp(value)/2:(Math.exp(value)+Math.exp(-value))/2):1/0},expm1:function(value){return value=Number(value),value===-1/0?-1:global_isFinite(value)&&0!==value?Math.exp(value)-1:value},hypot:function(){var anyNaN=!1,allZero=!0,anyInfinity=!1,numbers=[];if(Array.prototype.every.call(arguments,function(arg){var num=Number(arg);return Number.isNaN(num)?anyNaN=!0:1/0===num||num===-1/0?anyInfinity=!0:0!==num&&(allZero=!1),anyInfinity?!1:(anyNaN||numbers.push(Math.abs(num)),!0)}),anyInfinity)return 1/0;if(anyNaN)return 0/0;if(allZero)return 0;numbers.sort(function(a,b){return b-a});var largest=numbers[0],divided=numbers.map(function(number){return number/largest}),sum=divided.reduce(function(sum,number){return sum+=number*number},0);return largest*Math.sqrt(sum)},log2:function(value){return Math.log(value)*Math.LOG2E},log10:function(value){return Math.log(value)*Math.LOG10E},log1p:function(value){if(value=Number(value),-1>value||Number.isNaN(value))return 0/0;if(0===value||1/0===value)return value;if(-1===value)return-1/0;var result=0,n=50;if(0>value||value>1)return Math.log(1+value);for(var i=1;n>i;i++)i%2===0?result-=Math.pow(value,i)/i:result+=Math.pow(value,i)/i;return result},sign:function(value){var number=+value;return 0===number?number:Number.isNaN(number)?number:0>number?-1:1},sinh:function(value){return value=Number(value),global_isFinite(value)&&0!==value?(Math.exp(value)-Math.exp(-value))/2:value},tanh:function(value){return value=Number(value),Number.isNaN(value)||0===value?value:1/0===value?1:value===-1/0?-1:(Math.exp(value)-Math.exp(-value))/(Math.exp(value)+Math.exp(-value))},trunc:function(value){var number=Number(value);return 0>number?-Math.floor(-number):Math.floor(number)},imul:function(x,y){x=ES.ToUint32(x),y=ES.ToUint32(y);var ah=x>>>16&65535,al=65535&x,bh=y>>>16&65535,bl=65535&y;return al*bl+(ah*bl+al*bh<<16>>>0)|0},fround:function(x){if(0===x||1/0===x||x===-1/0||Number.isNaN(x))return x;var num=Number(x);return numberConversion.toFloat32(num)}};defineProperties(Math,MathShims),-5!==Math.imul(4294967295,5)&&(Math.imul=MathShims.imul);var PromiseShim=function(){var Promise,Promise$prototype;ES.IsPromise=function(promise){return ES.TypeIsObject(promise)&&promise._promiseConstructor?"undefined"==typeof promise._status?!1:!0:!1};var makeZeroTimeout,PromiseCapability=function(C){if(!ES.IsCallable(C))throw new TypeError("bad promise constructor");var capability=this,resolver=function(resolve,reject){capability.resolve=resolve,capability.reject=reject};if(capability.promise=ES.Construct(C,[resolver]),!capability.promise._es6construct)throw new TypeError("bad promise constructor");if(!ES.IsCallable(capability.resolve)||!ES.IsCallable(capability.reject))throw new TypeError("bad promise constructor")},setTimeout=globals.setTimeout;"undefined"!=typeof window&&ES.IsCallable(window.postMessage)&&(makeZeroTimeout=function(){var timeouts=[],messageName="zero-timeout-message",setZeroTimeout=function(fn){timeouts.push(fn),window.postMessage(messageName,"*")},handleMessage=function(event){if(event.source==window&&event.data==messageName){if(event.stopPropagation(),0===timeouts.length)return;var fn=timeouts.shift();fn()}};return window.addEventListener("message",handleMessage,!0),setZeroTimeout});var makePromiseAsap=function(){var P=globals.Promise;return P&&P.resolve&&function(task){return P.resolve().then(task)}},enqueue=ES.IsCallable(globals.setImmediate)?globals.setImmediate.bind(globals):"object"==typeof process&&process.nextTick?process.nextTick:makePromiseAsap()||(ES.IsCallable(makeZeroTimeout)?makeZeroTimeout():function(task){setTimeout(task,0)}),triggerPromiseReactions=function(reactions,x){reactions.forEach(function(reaction){enqueue(function(){var handler=reaction.handler,capability=reaction.capability,resolve=capability.resolve,reject=capability.reject;try{var result=handler(x);if(result===capability.promise)throw new TypeError("self resolution");var updateResult=updatePromiseFromPotentialThenable(result,capability);updateResult||resolve(result)}catch(e){reject(e)}})})},updatePromiseFromPotentialThenable=function(x,capability){if(!ES.TypeIsObject(x))return!1;var resolve=capability.resolve,reject=capability.reject;try{var then=x.then;if(!ES.IsCallable(then))return!1;then.call(x,resolve,reject)}catch(e){reject(e)}return!0},promiseResolutionHandler=function(promise,onFulfilled,onRejected){return function(x){if(x===promise)return onRejected(new TypeError("self resolution"));var C=promise._promiseConstructor,capability=new PromiseCapability(C),updateResult=updatePromiseFromPotentialThenable(x,capability);return updateResult?capability.promise.then(onFulfilled,onRejected):onFulfilled(x)}};Promise=function(resolver){var promise=this;if(promise=emulateES6construct(promise),!promise._promiseConstructor)throw new TypeError("bad promise");if("undefined"!=typeof promise._status)throw new TypeError("promise already initialized");if(!ES.IsCallable(resolver))throw new TypeError("not a valid resolver");promise._status="unresolved",promise._resolveReactions=[],promise._rejectReactions=[];var resolve=function(resolution){if("unresolved"===promise._status){var reactions=promise._resolveReactions;promise._result=resolution,promise._resolveReactions=void 0,promise._rejectReactions=void 0,promise._status="has-resolution",triggerPromiseReactions(reactions,resolution)}},reject=function(reason){if("unresolved"===promise._status){var reactions=promise._rejectReactions;promise._result=reason,promise._resolveReactions=void 0,promise._rejectReactions=void 0,promise._status="has-rejection",triggerPromiseReactions(reactions,reason)}};try{resolver(resolve,reject)}catch(e){reject(e)}return promise},Promise$prototype=Promise.prototype;var _promiseAllResolver=function(index,values,capability,remaining){var done=!1;return function(x){if(!done&&(done=!0,values[index]=x,0===--remaining.count)){var resolve=capability.resolve;resolve(values)}}};return defineProperties(Promise,{"@@create":function(obj){var constructor=this,prototype=constructor.prototype||Promise$prototype;return obj=obj||create(prototype),defineProperties(obj,{_status:void 0,_result:void 0,_resolveReactions:void 0,_rejectReactions:void 0,_promiseConstructor:void 0}),obj._promiseConstructor=constructor,obj},all:function(iterable){var C=this,capability=new PromiseCapability(C),resolve=capability.resolve,reject=capability.reject;try{if(!ES.IsIterable(iterable))throw new TypeError("bad iterable");for(var it=ES.GetIterator(iterable),values=[],remaining={count:1},index=0;;index++){var next=ES.IteratorNext(it);if(next.done)break;var nextPromise=C.resolve(next.value),resolveElement=_promiseAllResolver(index,values,capability,remaining);remaining.count++,nextPromise.then(resolveElement,capability.reject)}0===--remaining.count&&resolve(values)}catch(e){reject(e)}return capability.promise},race:function(iterable){var C=this,capability=new PromiseCapability(C),resolve=capability.resolve,reject=capability.reject;try{if(!ES.IsIterable(iterable))throw new TypeError("bad iterable");for(var it=ES.GetIterator(iterable);;){var next=ES.IteratorNext(it);if(next.done)break;var nextPromise=C.resolve(next.value);nextPromise.then(resolve,reject)}}catch(e){reject(e)}return capability.promise},reject:function(reason){var C=this,capability=new PromiseCapability(C),rejectPromise=capability.reject;return rejectPromise(reason),capability.promise},resolve:function(v){var C=this;if(ES.IsPromise(v)){var constructor=v._promiseConstructor;if(constructor===C)return v}var capability=new PromiseCapability(C),resolvePromise=capability.resolve;return resolvePromise(v),capability.promise}}),defineProperties(Promise$prototype,{"catch":function(onRejected){return this.then(void 0,onRejected)},then:function(onFulfilled,onRejected){var promise=this;if(!ES.IsPromise(promise))throw new TypeError("not a promise");var C=this.constructor,capability=new PromiseCapability(C);ES.IsCallable(onRejected)||(onRejected=function(e){throw e}),ES.IsCallable(onFulfilled)||(onFulfilled=function(x){return x});var resolutionHandler=promiseResolutionHandler(promise,onFulfilled,onRejected),resolveReaction={capability:capability,handler:resolutionHandler},rejectReaction={capability:capability,handler:onRejected};switch(promise._status){case"unresolved":promise._resolveReactions.push(resolveReaction),promise._rejectReactions.push(rejectReaction);break;case"has-resolution":triggerPromiseReactions([resolveReaction],promise._result);break;case"has-rejection":triggerPromiseReactions([rejectReaction],promise._result);break;default:throw new TypeError("unexpected")}return capability.promise}}),Promise}();globals.Promise&&(delete globals.Promise.accept,delete globals.Promise.defer,delete globals.Promise.prototype.chain),defineProperties(globals,{Promise:PromiseShim});var promiseSupportsSubclassing=supportsSubclassing(globals.Promise,function(S){return S.resolve(42)instanceof S}),promiseIgnoresNonFunctionThenCallbacks=function(){try{return globals.Promise.reject(42).then(null,5).then(null,function(){}),!0}catch(ex){return!1}}(),promiseRequiresObjectContext=function(){try{Promise.call(3,function(){})}catch(e){return!0}return!1}();promiseSupportsSubclassing&&promiseIgnoresNonFunctionThenCallbacks&&promiseRequiresObjectContext||(Promise=PromiseShim,defineProperty(globals,"Promise",PromiseShim,!0));var testOrder=function(a){var b=Object.keys(a.reduce(function(o,k){return o[k]=!0,o},{}));return a.join(":")===b.join(":")},preservesInsertionOrder=testOrder(["z","a","bb"]),preservesNumericInsertionOrder=testOrder(["z",1,"a","3",2]);if(supportsDescriptors){var fastkey=function(key){if(!preservesInsertionOrder)return null;var type=typeof key;return"string"===type?"$"+key:"number"===type?preservesNumericInsertionOrder?key:"n"+key:null},emptyObject=function(){return Object.create?Object.create(null):{}},collectionShims={Map:function(){function MapEntry(key,value){this.key=key,this.value=value,this.next=null,this.prev=null}function MapIterator(map,kind){this.head=map._head,this.i=this.head,this.kind=kind}function Map(iterable){var map=this;if(!ES.TypeIsObject(map))throw new TypeError("Map does not accept arguments when called as a function");if(map=emulateES6construct(map),!map._es6map)throw new TypeError("bad map");var head=new MapEntry(null,null);if(head.next=head.prev=head,defineProperties(map,{_head:head,_storage:emptyObject(),_size:0}),"undefined"!=typeof iterable&&null!==iterable){var it=ES.GetIterator(iterable),adder=map.set;if(!ES.IsCallable(adder))throw new TypeError("bad map");for(;;){var next=ES.IteratorNext(it);if(next.done)break;var nextItem=next.value;if(!ES.TypeIsObject(nextItem))throw new TypeError("expected iterable of pairs");adder.call(map,nextItem[0],nextItem[1])}}return map}var empty={};MapEntry.prototype.isRemoved=function(){return this.key===empty},MapIterator.prototype={next:function(){var result,i=this.i,kind=this.kind,head=this.head;if("undefined"==typeof this.i)return{value:void 0,done:!0};for(;i.isRemoved()&&i!==head;)i=i.prev;for(;i.next!==head;)if(i=i.next,!i.isRemoved())return result="key"===kind?i.key:"value"===kind?i.value:[i.key,i.value],this.i=i,{value:result,done:!1};return this.i=void 0,{value:void 0,done:!0}}},addIterator(MapIterator.prototype);var Map$prototype=Map.prototype;return defineProperties(Map,{"@@create":function(obj){var constructor=this,prototype=constructor.prototype||Map$prototype;return obj=obj||create(prototype),defineProperties(obj,{_es6map:!0}),obj}}),Object.defineProperty(Map.prototype,"size",{configurable:!0,enumerable:!1,get:function(){if("undefined"==typeof this._size)throw new TypeError("size method called on incompatible Map");return this._size}}),defineProperties(Map.prototype,{get:function(key){var fkey=fastkey(key);if(null!==fkey){var entry=this._storage[fkey];return entry?entry.value:void 0}for(var head=this._head,i=head;(i=i.next)!==head;)if(ES.SameValueZero(i.key,key))return i.value},has:function(key){var fkey=fastkey(key);if(null!==fkey)return"undefined"!=typeof this._storage[fkey];for(var head=this._head,i=head;(i=i.next)!==head;)if(ES.SameValueZero(i.key,key))return!0;return!1},set:function(key,value){var entry,head=this._head,i=head,fkey=fastkey(key);if(null!==fkey){if("undefined"!=typeof this._storage[fkey])return this._storage[fkey].value=value,this;entry=this._storage[fkey]=new MapEntry(key,value),i=head.prev}for(;(i=i.next)!==head;)if(ES.SameValueZero(i.key,key))return i.value=value,this;
return entry=entry||new MapEntry(key,value),ES.SameValue(-0,key)&&(entry.key=0),entry.next=this._head,entry.prev=this._head.prev,entry.prev.next=entry,entry.next.prev=entry,this._size+=1,this},"delete":function(key){var head=this._head,i=head,fkey=fastkey(key);if(null!==fkey){if("undefined"==typeof this._storage[fkey])return!1;i=this._storage[fkey].prev,delete this._storage[fkey]}for(;(i=i.next)!==head;)if(ES.SameValueZero(i.key,key))return i.key=i.value=empty,i.prev.next=i.next,i.next.prev=i.prev,this._size-=1,!0;return!1},clear:function(){this._size=0,this._storage=emptyObject();for(var head=this._head,i=head,p=i.next;(i=p)!==head;)i.key=i.value=empty,p=i.next,i.next=i.prev=head;head.next=head.prev=head},keys:function(){return new MapIterator(this,"key")},values:function(){return new MapIterator(this,"value")},entries:function(){return new MapIterator(this,"key+value")},forEach:function(callback){for(var context=arguments.length>1?arguments[1]:null,it=this.entries(),entry=it.next();!entry.done;entry=it.next())context?callback.call(context,entry.value[1],entry.value[0],this):callback(entry.value[1],entry.value[0],this)}}),addIterator(Map.prototype,function(){return this.entries()}),Map}(),Set:function(){var SetShim=function(iterable){var set=this;if(!ES.TypeIsObject(set))throw new TypeError("Set does not accept arguments when called as a function");if(set=emulateES6construct(set),!set._es6set)throw new TypeError("bad set");if(defineProperties(set,{"[[SetData]]":null,_storage:emptyObject()}),"undefined"!=typeof iterable&&null!==iterable){var it=ES.GetIterator(iterable),adder=set.add;if(!ES.IsCallable(adder))throw new TypeError("bad set");for(;;){var next=ES.IteratorNext(it);if(next.done)break;var nextItem=next.value;adder.call(set,nextItem)}}return set},Set$prototype=SetShim.prototype;defineProperties(SetShim,{"@@create":function(obj){var constructor=this,prototype=constructor.prototype||Set$prototype;return obj=obj||create(prototype),defineProperties(obj,{_es6set:!0}),obj}});var ensureMap=function(set){if(!set["[[SetData]]"]){var m=set["[[SetData]]"]=new collectionShims.Map;Object.keys(set._storage).forEach(function(k){k=36===k.charCodeAt(0)?k.slice(1):"n"===k.charAt(0)?+k.slice(1):+k,m.set(k,k)}),set._storage=null}};return Object.defineProperty(SetShim.prototype,"size",{configurable:!0,enumerable:!1,get:function(){if("undefined"==typeof this._storage)throw new TypeError("size method called on incompatible Set");return ensureMap(this),this["[[SetData]]"].size}}),defineProperties(SetShim.prototype,{has:function(key){var fkey;return this._storage&&null!==(fkey=fastkey(key))?!!this._storage[fkey]:(ensureMap(this),this["[[SetData]]"].has(key))},add:function(key){var fkey;return this._storage&&null!==(fkey=fastkey(key))?(this._storage[fkey]=!0,this):(ensureMap(this),this["[[SetData]]"].set(key,key),this)},"delete":function(key){var fkey;if(this._storage&&null!==(fkey=fastkey(key))){var hasFKey=_hasOwnProperty(this._storage,fkey);return delete this._storage[fkey]&&hasFKey}return ensureMap(this),this["[[SetData]]"]["delete"](key)},clear:function(){return this._storage?void(this._storage=emptyObject()):this["[[SetData]]"].clear()},values:function(){return ensureMap(this),this["[[SetData]]"].values()},entries:function(){return ensureMap(this),this["[[SetData]]"].entries()},forEach:function(callback){var context=arguments.length>1?arguments[1]:null,entireSet=this;ensureMap(entireSet),this["[[SetData]]"].forEach(function(value,key){context?callback.call(context,key,key,entireSet):callback(key,key,entireSet)})}}),defineProperty(SetShim,"keys",SetShim.values,!0),addIterator(SetShim.prototype,function(){return this.values()}),SetShim}()};defineProperties(globals,collectionShims),(globals.Map||globals.Set)&&("function"!=typeof globals.Map.prototype.clear||0!==(new globals.Set).size||0!==(new globals.Map).size||"function"!=typeof globals.Map.prototype.keys||"function"!=typeof globals.Set.prototype.keys||"function"!=typeof globals.Map.prototype.forEach||"function"!=typeof globals.Set.prototype.forEach||isCallableWithoutNew(globals.Map)||isCallableWithoutNew(globals.Set)||!supportsSubclassing(globals.Map,function(M){var m=new M([]);return m.set(42,42),m instanceof M}))&&(globals.Map=collectionShims.Map,globals.Set=collectionShims.Set),globals.Set.prototype.keys!==globals.Set.prototype.values&&defineProperty(globals.Set.prototype,"keys",globals.Set.prototype.values,!0),addIterator(Object.getPrototypeOf((new globals.Map).keys())),addIterator(Object.getPrototypeOf((new globals.Set).keys()))}return globals})}).call(this,require("_process"))},{_process:4}],3:[function(require,module,exports){!function(root,factory){"function"==typeof define&&define.amd?define("eventable",function(){return root.Eventable=factory()}):"undefined"!=typeof exports?module.exports=factory():root.Eventable=factory()}(this,function(){function once(func){var memo,times=2;return function(){return--times>0?memo=func.apply(this,arguments):func=null,memo}}function addListenMethod(method,implementation){Eventable[method]=function(obj,name,callback){var listeners=this._listeners||(this._listeners={}),id=obj._listenerId||(obj._listenerId=(new Date).getTime());return listeners[id]=obj,"object"==typeof name&&(callback=this),obj[implementation](name,callback,this),this}}var array=[],slice=array.slice,Eventable={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);return events.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,func=once(function(){self.off(name,func),callback.apply(this,arguments)});return func._callback=callback,this.on(name,func,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events={},this;for(names=name?[name]:Object.keys(this._events),i=0,l=names.length;l>i;i++)if(name=names[i],events=this._events[name]){if(this._events[name]=retain=[],callback||context)for(j=0,k=events.length;k>j;j++)ev=events[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev);retain.length||delete this._events[name]}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;return events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this},stopListening:function(obj,name,callback){var listeners=this._listeners;if(!listeners)return this;var deleteListener=!name&&!callback;"object"==typeof name&&(callback=this),obj&&((listeners={})[obj._listenerId]=obj);for(var id in listeners)listeners[id].off(name,callback,this),deleteListener&&delete this._listeners[id];return this}},eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name){for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args)}};return addListenMethod("listenTo","on"),addListenMethod("listenToOnce","once"),Eventable.bind=Eventable.on,Eventable.unbind=Eventable.off,Eventable})},{}],4:[function(require,module){function noop(){}var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canMutationObserver="undefined"!=typeof window&&window.MutationObserver,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement("div"),observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0,queueList.forEach(function(fn){fn()})});return observer.observe(hiddenDiv,{attributes:!0}),function(fn){queue.length||hiddenDiv.setAttribute("yes","no"),queue.push(fn)}}return canPost?(window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}):function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")}},{}],5:[function(require,module){function isEmpty(value){var result=!0;if(!value)return result;var className=toString.call(value),length=value.length;return className==arrayClass||className==stringClass||className==argsClass||className==objectClass&&"number"==typeof length&&isFunction(value.splice)?!length:(forOwn(value,function(){return result=!1}),result)}var forOwn=require("lodash.forown"),isFunction=require("lodash.isfunction"),argsClass="[object Arguments]",arrayClass="[object Array]",objectClass="[object Object]",stringClass="[object String]",objectProto=Object.prototype,toString=objectProto.toString;module.exports=isEmpty},{"lodash.forown":6,"lodash.isfunction":29}],6:[function(require,module){var baseCreateCallback=require("lodash._basecreatecallback"),keys=require("lodash.keys"),objectTypes=require("lodash._objecttypes"),forOwn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;callback=callback&&"undefined"==typeof thisArg?callback:baseCreateCallback(callback,thisArg,3);for(var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;++ownIndex<length;)if(index=ownProps[ownIndex],callback(iterable[index],index,collection)===!1)return result;return result};module.exports=forOwn},{"lodash._basecreatecallback":7,"lodash._objecttypes":25,"lodash.keys":26}],7:[function(require,module){function baseCreateCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if("undefined"==typeof thisArg||!("prototype"in func))return func;var bindData=func.__bindData__;if("undefined"==typeof bindData&&(support.funcNames&&(bindData=!func.name),bindData=bindData||!support.funcDecomp,!bindData)){var source=fnToString.call(func);support.funcNames||(bindData=!reFuncName.test(source)),bindData||(bindData=reThis.test(source),setBindData(func,bindData))}if(bindData===!1||bindData!==!0&&1&bindData[1])return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 2:return function(a,b){return func.call(thisArg,a,b)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)}}return bind(func,thisArg)}var bind=require("lodash.bind"),identity=require("lodash.identity"),setBindData=require("lodash._setbinddata"),support=require("lodash.support"),reFuncName=/^\s*function[ \n\r\t]+\w/,reThis=/\bthis\b/,fnToString=Function.prototype.toString;module.exports=baseCreateCallback},{"lodash._setbinddata":8,"lodash.bind":11,"lodash.identity":22,"lodash.support":23}],8:[function(require,module){var isNative=require("lodash._isnative"),noop=require("lodash.noop"),descriptor={configurable:!1,enumerable:!1,value:null,writable:!1},defineProperty=function(){try{var o={},func=isNative(func=Object.defineProperty)&&func,result=func(o,o,o)&&func}catch(e){}return result}(),setBindData=defineProperty?function(func,value){descriptor.value=value,defineProperty(func,"__bindData__",descriptor)}:noop;module.exports=setBindData},{"lodash._isnative":9,"lodash.noop":10}],9:[function(require,module){function isNative(value){return"function"==typeof value&&reNative.test(value)}var objectProto=Object.prototype,toString=objectProto.toString,reNative=RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");module.exports=isNative},{}],10:[function(require,module){function noop(){}module.exports=noop},{}],11:[function(require,module){function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg)}var createWrapper=require("lodash._createwrapper"),slice=require("lodash._slice");module.exports=bind},{"lodash._createwrapper":12,"lodash._slice":21}],12:[function(require,module){function createWrapper(func,bitmask,partialArgs,partialRightArgs,thisArg,arity){var isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isPartial=16&bitmask,isPartialRight=32&bitmask;if(!isBindKey&&!isFunction(func))throw new TypeError;isPartial&&!partialArgs.length&&(bitmask&=-17,isPartial=partialArgs=!1),isPartialRight&&!partialRightArgs.length&&(bitmask&=-33,isPartialRight=partialRightArgs=!1);var bindData=func&&func.__bindData__;if(bindData&&bindData!==!0)return bindData=slice(bindData),bindData[2]&&(bindData[2]=slice(bindData[2])),bindData[3]&&(bindData[3]=slice(bindData[3])),!isBind||1&bindData[1]||(bindData[4]=thisArg),!isBind&&1&bindData[1]&&(bitmask|=8),!isCurry||4&bindData[1]||(bindData[5]=arity),isPartial&&push.apply(bindData[2]||(bindData[2]=[]),partialArgs),isPartialRight&&unshift.apply(bindData[3]||(bindData[3]=[]),partialRightArgs),bindData[1]|=bitmask,createWrapper.apply(null,bindData);var creater=1==bitmask||17===bitmask?baseBind:baseCreateWrapper;return creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity])}var baseBind=require("lodash._basebind"),baseCreateWrapper=require("lodash._basecreatewrapper"),isFunction=require("lodash.isfunction"),slice=require("lodash._slice"),arrayRef=[],push=arrayRef.push,unshift=arrayRef.unshift;module.exports=createWrapper},{"lodash._basebind":13,"lodash._basecreatewrapper":17,"lodash._slice":21,"lodash.isfunction":29}],13:[function(require,module){function baseBind(bindData){function bound(){if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if(this instanceof bound){var thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments);return isObject(result)?result:thisBinding}return func.apply(thisArg,args||arguments)}var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];return setBindData(bound,bindData),bound}var baseCreate=require("lodash._basecreate"),isObject=require("lodash.isobject"),setBindData=require("lodash._setbinddata"),slice=require("lodash._slice"),arrayRef=[],push=arrayRef.push;module.exports=baseBind},{"lodash._basecreate":14,"lodash._setbinddata":8,"lodash._slice":21,"lodash.isobject":30}],14:[function(require,module){(function(global){function baseCreate(prototype){return isObject(prototype)?nativeCreate(prototype):{}}var isNative=require("lodash._isnative"),isObject=require("lodash.isobject"),nativeCreate=(require("lodash.noop"),isNative(nativeCreate=Object.create)&&nativeCreate);nativeCreate||(baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||global.Object()}}()),module.exports=baseCreate}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._isnative":15,"lodash.isobject":30,"lodash.noop":16}],15:[function(require,module){module.exports=require(9)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._basecreatecallback/node_modules/lodash._setbinddata/node_modules/lodash._isnative/index.js":9}],16:[function(require,module){module.exports=require(10)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._basecreatecallback/node_modules/lodash._setbinddata/node_modules/lodash.noop/index.js":10}],17:[function(require,module){function baseCreateWrapper(bindData){function bound(){var thisBinding=isBind?thisArg:this;if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if((partialRightArgs||isCurry)&&(args||(args=slice(arguments)),partialRightArgs&&push.apply(args,partialRightArgs),isCurry&&args.length<arity))return bitmask|=16,baseCreateWrapper([func,isCurryBound?bitmask:-4&bitmask,args,null,thisArg,arity]);if(args||(args=arguments),isBindKey&&(func=thisBinding[key]),this instanceof bound){thisBinding=baseCreate(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding}return func.apply(thisBinding,args)}var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5],isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isCurryBound=8&bitmask,key=func;return setBindData(bound,bindData),bound}var baseCreate=require("lodash._basecreate"),isObject=require("lodash.isobject"),setBindData=require("lodash._setbinddata"),slice=require("lodash._slice"),arrayRef=[],push=arrayRef.push;module.exports=baseCreateWrapper},{"lodash._basecreate":18,"lodash._setbinddata":8,"lodash._slice":21,"lodash.isobject":30}],18:[function(require,module){module.exports=require(14)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._basecreatecallback/node_modules/lodash.bind/node_modules/lodash._createwrapper/node_modules/lodash._basebind/node_modules/lodash._basecreate/index.js":14,"lodash._isnative":19,"lodash.isobject":30,"lodash.noop":20}],19:[function(require,module){module.exports=require(9)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._basecreatecallback/node_modules/lodash._setbinddata/node_modules/lodash._isnative/index.js":9}],20:[function(require,module){module.exports=require(10)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._basecreatecallback/node_modules/lodash._setbinddata/node_modules/lodash.noop/index.js":10}],21:[function(require,module){function slice(array,start,end){start||(start=0),"undefined"==typeof end&&(end=array?array.length:0);for(var index=-1,length=end-start||0,result=Array(0>length?0:length);++index<length;)result[index]=array[start+index];return result}module.exports=slice},{}],22:[function(require,module){function identity(value){return value}module.exports=identity},{}],23:[function(require,module){(function(global){var isNative=require("lodash._isnative"),reThis=/\bthis\b/,support={};support.funcDecomp=!isNative(global.WinRTError)&&reThis.test(function(){return this}),support.funcNames="string"==typeof Function.name,module.exports=support}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._isnative":24}],24:[function(require,module){module.exports=require(9)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._basecreatecallback/node_modules/lodash._setbinddata/node_modules/lodash._isnative/index.js":9}],25:[function(require,module){var objectTypes={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};module.exports=objectTypes},{}],26:[function(require,module){var isNative=require("lodash._isnative"),isObject=require("lodash.isobject"),shimKeys=require("lodash._shimkeys"),nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,keys=nativeKeys?function(object){return isObject(object)?nativeKeys(object):[]}:shimKeys;module.exports=keys},{"lodash._isnative":27,"lodash._shimkeys":28,"lodash.isobject":30}],27:[function(require,module){module.exports=require(9)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._basecreatecallback/node_modules/lodash._setbinddata/node_modules/lodash._isnative/index.js":9}],28:[function(require,module){var objectTypes=require("lodash._objecttypes"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,shimKeys=function(object){var index,iterable=object,result=[];if(!iterable)return result;if(!objectTypes[typeof object])return result;for(index in iterable)hasOwnProperty.call(iterable,index)&&result.push(index);return result};module.exports=shimKeys},{"lodash._objecttypes":25}],29:[function(require,module){function isFunction(value){return"function"==typeof value}module.exports=isFunction},{}],30:[function(require,module){function isObject(value){return!(!value||!objectTypes[typeof value])}var objectTypes=require("lodash._objecttypes");module.exports=isObject},{"lodash._objecttypes":31}],31:[function(require,module){module.exports=require(25)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._objecttypes/index.js":25}],32:[function(require,module){function isString(value){return"string"==typeof value||value&&"object"==typeof value&&toString.call(value)==stringClass||!1}var stringClass="[object String]",objectProto=Object.prototype,toString=objectProto.toString;module.exports=isString},{}],33:[function(require,module){function isUndefined(value){return"undefined"==typeof value}module.exports=isUndefined},{}],34:[function(require,module){function result(object,key){if(object){var value=object[key];return isFunction(value)?object[key]():value}}var isFunction=require("lodash.isfunction");module.exports=result},{"lodash.isfunction":29}],35:[function(require,module){function template(text,data,options){var settings=templateSettings.imports._.templateSettings||templateSettings;text=String(text||""),options=defaults({},options,settings);var isEvaluating,imports=defaults({},options.imports,settings.imports),importsKeys=keys(imports),importsValues=values(imports),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");text.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n";var variable=options.variable,hasVariable=variable;hasVariable||(variable="obj",source="with ("+variable+") {\n"+source+"\n}\n"),source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+variable+") {\n"+(hasVariable?"":variable+" || ("+variable+" = {});\n")+"var __t, __p = '', __e = _.escape"+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";try{var result=Function(importsKeys,"return "+source).apply(void 0,importsValues)}catch(e){throw e.source=source,e}return data?result(data):(result.source=source,result)}var defaults=require("lodash.defaults"),escapeStringChar=(require("lodash.escape"),require("lodash._escapestringchar")),keys=require("lodash.keys"),reInterpolate=require("lodash._reinterpolate"),templateSettings=require("lodash.templatesettings"),values=require("lodash.values"),reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\t\u2028\u2029\\]/g;module.exports=template},{"lodash._escapestringchar":36,"lodash._reinterpolate":37,"lodash.defaults":38,"lodash.escape":40,"lodash.keys":45,"lodash.templatesettings":49,"lodash.values":50}],36:[function(require,module){function escapeStringChar(match){return"\\"+stringEscapes[match]}var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};module.exports=escapeStringChar},{}],37:[function(require,module){var reInterpolate=/<%=([\s\S]+?)%>/g;module.exports=reInterpolate},{}],38:[function(require,module){var keys=require("lodash.keys"),objectTypes=require("lodash._objecttypes"),defaults=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;for(var args=arguments,argsIndex=0,argsLength="number"==typeof guard?2:args.length;++argsIndex<argsLength;)if(iterable=args[argsIndex],iterable&&objectTypes[typeof iterable])for(var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;++ownIndex<length;)index=ownProps[ownIndex],"undefined"==typeof result[index]&&(result[index]=iterable[index]);return result};module.exports=defaults},{"lodash._objecttypes":39,"lodash.keys":45}],39:[function(require,module){module.exports=require(25)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._objecttypes/index.js":25}],40:[function(require,module){function escape(string){return null==string?"":String(string).replace(reUnescapedHtml,escapeHtmlChar)}var escapeHtmlChar=require("lodash._escapehtmlchar"),reUnescapedHtml=(require("lodash.keys"),require("lodash._reunescapedhtml"));module.exports=escape},{"lodash._escapehtmlchar":41,"lodash._reunescapedhtml":43,"lodash.keys":45}],41:[function(require,module){function escapeHtmlChar(match){return htmlEscapes[match]}var htmlEscapes=require("lodash._htmlescapes");module.exports=escapeHtmlChar},{"lodash._htmlescapes":42}],42:[function(require,module){var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};module.exports=htmlEscapes},{}],43:[function(require,module){var htmlEscapes=require("lodash._htmlescapes"),keys=require("lodash.keys"),reUnescapedHtml=RegExp("["+keys(htmlEscapes).join("")+"]","g");module.exports=reUnescapedHtml},{"lodash._htmlescapes":44,"lodash.keys":45}],44:[function(require,module){module.exports=require(42)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.template/node_modules/lodash.escape/node_modules/lodash._escapehtmlchar/node_modules/lodash._htmlescapes/index.js":42}],45:[function(require,module){module.exports=require(26)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash.keys/index.js":26,"lodash._isnative":46,"lodash._shimkeys":47,"lodash.isobject":30}],46:[function(require,module){module.exports=require(9)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._basecreatecallback/node_modules/lodash._setbinddata/node_modules/lodash._isnative/index.js":9}],47:[function(require,module){module.exports=require(28)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash.keys/node_modules/lodash._shimkeys/index.js":28,"lodash._objecttypes":48}],48:[function(require,module){module.exports=require(25)},{"/Users/dan/Development/sir-trevor-js/node_modules/lodash.isempty/node_modules/lodash.forown/node_modules/lodash._objecttypes/index.js":25}],49:[function(require,module){var escape=require("lodash.escape"),reInterpolate=require("lodash._reinterpolate"),templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:reInterpolate,variable:"",imports:{_:{escape:escape}}};module.exports=templateSettings},{"lodash._reinterpolate":37,"lodash.escape":40}],50:[function(require,module){function values(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}var keys=require("lodash.keys");module.exports=values},{"lodash.keys":45}],51:[function(require,module){function uniqueId(prefix){var id=++idCounter;return String(null==prefix?"":prefix)+id}var idCounter=0;module.exports=uniqueId},{}],52:[function(require,module){function flatten(array,isShallow,callback,thisArg){return"boolean"!=typeof isShallow&&null!=isShallow&&(thisArg=callback,callback="function"!=typeof isShallow&&thisArg&&thisArg[isShallow]===array?null:isShallow,isShallow=!1),null!=callback&&(array=map(array,callback,thisArg)),baseFlatten(array,isShallow)}var baseFlatten=require("../internals/baseFlatten"),map=require("../collections/map");module.exports=flatten},{"../collections/map":56,"../internals/baseFlatten":65}],53:[function(require,module){function last(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=length;for(callback=createCallback(callback,thisArg,3);index--&&callback(array[index],index,array);)n++}else if(n=callback,null==n||thisArg)return array?array[length-1]:undefined;return slice(array,nativeMax(0,length-n))}var undefined,createCallback=require("../functions/createCallback"),slice=require("../internals/slice"),nativeMax=Math.max;module.exports=last},{"../functions/createCallback":59,"../internals/slice":79}],54:[function(require,module){function pull(array){for(var args=arguments,argsIndex=0,argsLength=args.length,length=array?array.length:0;++argsIndex<argsLength;)for(var index=-1,value=args[argsIndex];++index<length;)array[index]===value&&(splice.call(array,index--,1),length--);return array}var arrayRef=[],splice=arrayRef.splice;module.exports=pull},{}],55:[function(require,module){function contains(collection,target,fromIndex){var index=-1,indexOf=baseIndexOf,length=collection?collection.length:0,result=!1;return fromIndex=(0>fromIndex?nativeMax(0,length+fromIndex):fromIndex)||0,isArray(collection)?result=indexOf(collection,target,fromIndex)>-1:"number"==typeof length?result=(isString(collection)?collection.indexOf(target,fromIndex):indexOf(collection,target,fromIndex))>-1:forOwn(collection,function(value){return++index>=fromIndex?!(result=value===target):void 0}),result}var baseIndexOf=require("../internals/baseIndexOf"),forOwn=require("../objects/forOwn"),isArray=require("../objects/isArray"),isString=require("../objects/isString"),nativeMax=Math.max;module.exports=contains},{"../internals/baseIndexOf":66,"../objects/forOwn":83,"../objects/isArray":85,"../objects/isString":88}],56:[function(require,module){function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;if(callback=createCallback(callback,thisArg,3),"number"==typeof length)for(var result=Array(length);++index<length;)result[index]=callback(collection[index],index,collection);else result=[],forOwn(collection,function(value,key,collection){result[++index]=callback(value,key,collection)});return result}var createCallback=require("../functions/createCallback"),forOwn=require("../objects/forOwn");module.exports=map},{"../functions/createCallback":59,"../objects/forOwn":83}],57:[function(require,module){function toArray(collection){return collection&&"number"==typeof collection.length?slice(collection):values(collection)
}var slice=(require("../objects/isString"),require("../internals/slice")),values=require("../objects/values");module.exports=toArray},{"../internals/slice":79,"../objects/isString":88,"../objects/values":90}],58:[function(require,module){function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg)}var createWrapper=require("../internals/createWrapper"),slice=require("../internals/slice");module.exports=bind},{"../internals/createWrapper":68,"../internals/slice":79}],59:[function(require,module){function createCallback(func,thisArg,argCount){var type=typeof func;if(null==func||"function"==type)return baseCreateCallback(func,thisArg,argCount);if("object"!=type)return property(func);var props=keys(func),key=props[0],a=func[key];return 1!=props.length||a!==a||isObject(a)?function(object){for(var length=props.length,result=!1;length--&&(result=baseIsEqual(object[props[length]],func[props[length]],null,!0)););return result}:function(object){var b=object[key];return a===b&&(0!==a||1/a==1/b)}}var baseCreateCallback=require("../internals/baseCreateCallback"),baseIsEqual=require("../internals/baseIsEqual"),isObject=require("../objects/isObject"),keys=require("../objects/keys"),property=require("../utilities/property");module.exports=createCallback},{"../internals/baseCreateCallback":63,"../internals/baseIsEqual":67,"../objects/isObject":87,"../objects/keys":89,"../utilities/property":95}],60:[function(require,module){var arrayPool=[];module.exports=arrayPool},{}],61:[function(require,module){function baseBind(bindData){function bound(){if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if(this instanceof bound){var thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments);return isObject(result)?result:thisBinding}return func.apply(thisArg,args||arguments)}var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];return setBindData(bound,bindData),bound}var baseCreate=require("./baseCreate"),isObject=require("../objects/isObject"),setBindData=require("./setBindData"),slice=require("./slice"),arrayRef=[],push=arrayRef.push;module.exports=baseBind},{"../objects/isObject":87,"./baseCreate":62,"./setBindData":77,"./slice":79}],62:[function(require,module){function baseCreate(prototype){return isObject(prototype)?nativeCreate(prototype):{}}var isNative=require("./isNative"),isObject=require("../objects/isObject"),nativeCreate=(require("../utilities/noop"),isNative(nativeCreate=Object.create)&&nativeCreate);nativeCreate||(baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||window.Object()}}()),module.exports=baseCreate},{"../objects/isObject":87,"../utilities/noop":94,"./isNative":72}],63:[function(require,module){function baseCreateCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if("undefined"==typeof thisArg||!("prototype"in func))return func;var bindData=func.__bindData__;if("undefined"==typeof bindData&&(support.funcNames&&(bindData=!func.name),bindData=bindData||!support.funcDecomp,!bindData)){var source=fnToString.call(func);support.funcNames||(bindData=!reFuncName.test(source)),bindData||(bindData=reThis.test(source),setBindData(func,bindData))}if(bindData===!1||bindData!==!0&&1&bindData[1])return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 2:return function(a,b){return func.call(thisArg,a,b)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)}}return bind(func,thisArg)}var bind=require("../functions/bind"),identity=require("../utilities/identity"),setBindData=require("./setBindData"),support=require("../support"),reFuncName=/^\s*function[ \n\r\t]+\w/,reThis=/\bthis\b/,fnToString=Function.prototype.toString;module.exports=baseCreateCallback},{"../functions/bind":58,"../support":91,"../utilities/identity":93,"./setBindData":77}],64:[function(require,module){function baseCreateWrapper(bindData){function bound(){var thisBinding=isBind?thisArg:this;if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if((partialRightArgs||isCurry)&&(args||(args=slice(arguments)),partialRightArgs&&push.apply(args,partialRightArgs),isCurry&&args.length<arity))return bitmask|=16,baseCreateWrapper([func,isCurryBound?bitmask:-4&bitmask,args,null,thisArg,arity]);if(args||(args=arguments),isBindKey&&(func=thisBinding[key]),this instanceof bound){thisBinding=baseCreate(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding}return func.apply(thisBinding,args)}var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5],isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isCurryBound=8&bitmask,key=func;return setBindData(bound,bindData),bound}var baseCreate=require("./baseCreate"),isObject=require("../objects/isObject"),setBindData=require("./setBindData"),slice=require("./slice"),arrayRef=[],push=arrayRef.push;module.exports=baseCreateWrapper},{"../objects/isObject":87,"./baseCreate":62,"./setBindData":77,"./slice":79}],65:[function(require,module){function baseFlatten(array,isShallow,isStrict,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0,result=[];++index<length;){var value=array[index];if(value&&"object"==typeof value&&"number"==typeof value.length&&(isArray(value)||isArguments(value))){isShallow||(value=baseFlatten(value,isShallow,isStrict));var valIndex=-1,valLength=value.length,resIndex=result.length;for(result.length+=valLength;++valIndex<valLength;)result[resIndex++]=value[valIndex]}else isStrict||result.push(value)}return result}var isArguments=require("../objects/isArguments"),isArray=require("../objects/isArray");module.exports=baseFlatten},{"../objects/isArguments":84,"../objects/isArray":85}],66:[function(require,module){function baseIndexOf(array,value,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0;++index<length;)if(array[index]===value)return index;return-1}module.exports=baseIndexOf},{}],67:[function(require,module){function baseIsEqual(a,b,callback,isWhere,stackA,stackB){if(callback){var result=callback(a,b);if("undefined"!=typeof result)return!!result}if(a===b)return 0!==a||1/a==1/b;var type=typeof a,otherType=typeof b;if(!(a!==a||a&&objectTypes[type]||b&&objectTypes[otherType]))return!1;if(null==a||null==b)return a===b;var className=toString.call(a),otherClass=toString.call(b);if(className==argsClass&&(className=objectClass),otherClass==argsClass&&(otherClass=objectClass),className!=otherClass)return!1;switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case regexpClass:case stringClass:return a==String(b)}var isArr=className==arrayClass;if(!isArr){var aWrapped=hasOwnProperty.call(a,"__wrapped__"),bWrapped=hasOwnProperty.call(b,"__wrapped__");if(aWrapped||bWrapped)return baseIsEqual(aWrapped?a.__wrapped__:a,bWrapped?b.__wrapped__:b,callback,isWhere,stackA,stackB);if(className!=objectClass)return!1;var ctorA=a.constructor,ctorB=b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)&&"constructor"in a&&"constructor"in b)return!1}var initedStack=!stackA;stackA||(stackA=getArray()),stackB||(stackB=getArray());for(var length=stackA.length;length--;)if(stackA[length]==a)return stackB[length]==b;var size=0;if(result=!0,stackA.push(a),stackB.push(b),isArr){if(length=a.length,size=b.length,result=size==length,result||isWhere)for(;size--;){var index=length,value=b[size];if(isWhere)for(;index--&&!(result=baseIsEqual(a[index],value,callback,isWhere,stackA,stackB)););else if(!(result=baseIsEqual(a[size],value,callback,isWhere,stackA,stackB)))break}}else forIn(b,function(value,key,b){return hasOwnProperty.call(b,key)?(size++,result=hasOwnProperty.call(a,key)&&baseIsEqual(a[key],value,callback,isWhere,stackA,stackB)):void 0}),result&&!isWhere&&forIn(a,function(value,key,a){return hasOwnProperty.call(a,key)?result=--size>-1:void 0});return stackA.pop(),stackB.pop(),initedStack&&(releaseArray(stackA),releaseArray(stackB)),result}var forIn=require("../objects/forIn"),getArray=require("./getArray"),isFunction=require("../objects/isFunction"),objectTypes=require("./objectTypes"),releaseArray=require("./releaseArray"),argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]",objectProto=Object.prototype,toString=objectProto.toString,hasOwnProperty=objectProto.hasOwnProperty;module.exports=baseIsEqual},{"../objects/forIn":82,"../objects/isFunction":86,"./getArray":70,"./objectTypes":74,"./releaseArray":76}],68:[function(require,module){function createWrapper(func,bitmask,partialArgs,partialRightArgs,thisArg,arity){var isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isPartial=16&bitmask,isPartialRight=32&bitmask;if(!isBindKey&&!isFunction(func))throw new TypeError;isPartial&&!partialArgs.length&&(bitmask&=-17,isPartial=partialArgs=!1),isPartialRight&&!partialRightArgs.length&&(bitmask&=-33,isPartialRight=partialRightArgs=!1);var bindData=func&&func.__bindData__;if(bindData&&bindData!==!0)return bindData=slice(bindData),bindData[2]&&(bindData[2]=slice(bindData[2])),bindData[3]&&(bindData[3]=slice(bindData[3])),!isBind||1&bindData[1]||(bindData[4]=thisArg),!isBind&&1&bindData[1]&&(bitmask|=8),!isCurry||4&bindData[1]||(bindData[5]=arity),isPartial&&push.apply(bindData[2]||(bindData[2]=[]),partialArgs),isPartialRight&&unshift.apply(bindData[3]||(bindData[3]=[]),partialRightArgs),bindData[1]|=bitmask,createWrapper.apply(null,bindData);var creater=1==bitmask||17===bitmask?baseBind:baseCreateWrapper;return creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity])}var baseBind=require("./baseBind"),baseCreateWrapper=require("./baseCreateWrapper"),isFunction=require("../objects/isFunction"),slice=require("./slice"),arrayRef=[],push=arrayRef.push,unshift=arrayRef.unshift;module.exports=createWrapper},{"../objects/isFunction":86,"./baseBind":61,"./baseCreateWrapper":64,"./slice":79}],69:[function(require,module){function escapeHtmlChar(match){return htmlEscapes[match]}var htmlEscapes=require("./htmlEscapes");module.exports=escapeHtmlChar},{"./htmlEscapes":71}],70:[function(require,module){function getArray(){return arrayPool.pop()||[]}var arrayPool=require("./arrayPool");module.exports=getArray},{"./arrayPool":60}],71:[function(require,module){var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};module.exports=htmlEscapes},{}],72:[function(require,module){function isNative(value){return"function"==typeof value&&reNative.test(value)}var objectProto=Object.prototype,toString=objectProto.toString,reNative=RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");module.exports=isNative},{}],73:[function(require,module){var maxPoolSize=40;module.exports=maxPoolSize},{}],74:[function(require,module){var objectTypes={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};module.exports=objectTypes},{}],75:[function(require,module){var htmlEscapes=require("./htmlEscapes"),keys=require("../objects/keys"),reUnescapedHtml=RegExp("["+keys(htmlEscapes).join("")+"]","g");module.exports=reUnescapedHtml},{"../objects/keys":89,"./htmlEscapes":71}],76:[function(require,module){function releaseArray(array){array.length=0,arrayPool.length<maxPoolSize&&arrayPool.push(array)}var arrayPool=require("./arrayPool"),maxPoolSize=require("./maxPoolSize");module.exports=releaseArray},{"./arrayPool":60,"./maxPoolSize":73}],77:[function(require,module){var isNative=require("./isNative"),noop=require("../utilities/noop"),descriptor={configurable:!1,enumerable:!1,value:null,writable:!1},defineProperty=function(){try{var o={},func=isNative(func=Object.defineProperty)&&func,result=func(o,o,o)&&func}catch(e){}return result}(),setBindData=defineProperty?function(func,value){descriptor.value=value,defineProperty(func,"__bindData__",descriptor)}:noop;module.exports=setBindData},{"../utilities/noop":94,"./isNative":72}],78:[function(require,module){var objectTypes=require("./objectTypes"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,shimKeys=function(object){var index,iterable=object,result=[];if(!iterable)return result;if(!objectTypes[typeof object])return result;for(index in iterable)hasOwnProperty.call(iterable,index)&&result.push(index);return result};module.exports=shimKeys},{"./objectTypes":74}],79:[function(require,module){function slice(array,start,end){start||(start=0),"undefined"==typeof end&&(end=array?array.length:0);for(var index=-1,length=end-start||0,result=Array(0>length?0:length);++index<length;)result[index]=array[start+index];return result}module.exports=slice},{}],80:[function(require,module){var baseCreateCallback=require("../internals/baseCreateCallback"),keys=require("./keys"),objectTypes=require("../internals/objectTypes"),assign=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;var args=arguments,argsIndex=0,argsLength="number"==typeof guard?2:args.length;if(argsLength>3&&"function"==typeof args[argsLength-2])var callback=baseCreateCallback(args[--argsLength-1],args[argsLength--],2);else argsLength>2&&"function"==typeof args[argsLength-1]&&(callback=args[--argsLength]);for(;++argsIndex<argsLength;)if(iterable=args[argsIndex],iterable&&objectTypes[typeof iterable])for(var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;++ownIndex<length;)index=ownProps[ownIndex],result[index]=callback?callback(result[index],iterable[index]):iterable[index];return result};module.exports=assign},{"../internals/baseCreateCallback":63,"../internals/objectTypes":74,"./keys":89}],81:[function(require,module){var keys=require("./keys"),objectTypes=require("../internals/objectTypes"),defaults=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;for(var args=arguments,argsIndex=0,argsLength="number"==typeof guard?2:args.length;++argsIndex<argsLength;)if(iterable=args[argsIndex],iterable&&objectTypes[typeof iterable])for(var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;++ownIndex<length;)index=ownProps[ownIndex],"undefined"==typeof result[index]&&(result[index]=iterable[index]);return result};module.exports=defaults},{"../internals/objectTypes":74,"./keys":89}],82:[function(require,module){var baseCreateCallback=require("../internals/baseCreateCallback"),objectTypes=require("../internals/objectTypes"),forIn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;callback=callback&&"undefined"==typeof thisArg?callback:baseCreateCallback(callback,thisArg,3);for(index in iterable)if(callback(iterable[index],index,collection)===!1)return result;return result};module.exports=forIn},{"../internals/baseCreateCallback":63,"../internals/objectTypes":74}],83:[function(require,module){var baseCreateCallback=require("../internals/baseCreateCallback"),keys=require("./keys"),objectTypes=require("../internals/objectTypes"),forOwn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;callback=callback&&"undefined"==typeof thisArg?callback:baseCreateCallback(callback,thisArg,3);for(var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;++ownIndex<length;)if(index=ownProps[ownIndex],callback(iterable[index],index,collection)===!1)return result;return result};module.exports=forOwn},{"../internals/baseCreateCallback":63,"../internals/objectTypes":74,"./keys":89}],84:[function(require,module){function isArguments(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==argsClass||!1}var argsClass="[object Arguments]",objectProto=Object.prototype,toString=objectProto.toString;module.exports=isArguments},{}],85:[function(require,module){var isNative=require("../internals/isNative"),arrayClass="[object Array]",objectProto=Object.prototype,toString=objectProto.toString,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,isArray=nativeIsArray||function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==arrayClass||!1};module.exports=isArray},{"../internals/isNative":72}],86:[function(require,module){function isFunction(value){return"function"==typeof value}module.exports=isFunction},{}],87:[function(require,module){function isObject(value){return!(!value||!objectTypes[typeof value])}var objectTypes=require("../internals/objectTypes");module.exports=isObject},{"../internals/objectTypes":74}],88:[function(require,module){function isString(value){return"string"==typeof value||value&&"object"==typeof value&&toString.call(value)==stringClass||!1}var stringClass="[object String]",objectProto=Object.prototype,toString=objectProto.toString;module.exports=isString},{}],89:[function(require,module){var isNative=require("../internals/isNative"),isObject=require("./isObject"),shimKeys=require("../internals/shimKeys"),nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,keys=nativeKeys?function(object){return isObject(object)?nativeKeys(object):[]}:shimKeys;module.exports=keys},{"../internals/isNative":72,"../internals/shimKeys":78,"./isObject":87}],90:[function(require,module){function values(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}var keys=require("./keys");module.exports=values},{"./keys":89}],91:[function(require,module){var isNative=require("./internals/isNative"),reThis=/\bthis\b/,support={};support.funcDecomp=!isNative(window.WinRTError)&&reThis.test(function(){return this}),support.funcNames="string"==typeof Function.name,module.exports=support},{"./internals/isNative":72}],92:[function(require,module){function escape(string){return null==string?"":String(string).replace(reUnescapedHtml,escapeHtmlChar)}var escapeHtmlChar=require("../internals/escapeHtmlChar"),reUnescapedHtml=(require("../objects/keys"),require("../internals/reUnescapedHtml"));module.exports=escape},{"../internals/escapeHtmlChar":69,"../internals/reUnescapedHtml":75,"../objects/keys":89}],93:[function(require,module){function identity(value){return value}module.exports=identity},{}],94:[function(require,module){function noop(){}module.exports=noop},{}],95:[function(require,module){function property(key){return function(object){return object[key]}}module.exports=property},{}],96:[function(require,module){var buildCommandPatch=require("./api/command-patch"),buildCommand=require("./api/command"),Node=require("./api/node"),buildSelection=require("./api/selection"),buildSimpleCommand=require("./api/simple-command");module.exports=function(scribe){this.CommandPatch=buildCommandPatch(scribe),this.Command=buildCommand(scribe),this.Node=Node,this.Selection=buildSelection(scribe),this.SimpleCommand=buildSimpleCommand(this,scribe)}},{"./api/command":98,"./api/command-patch":97,"./api/node":99,"./api/selection":100,"./api/simple-command":101}],97:[function(require,module){"use strict";module.exports=function(scribe){function CommandPatch(commandName){this.commandName=commandName}return CommandPatch.prototype.execute=function(value){scribe.transactionManager.run(function(){document.execCommand(this.commandName,!1,value||null)}.bind(this))},CommandPatch.prototype.queryState=function(){return document.queryCommandState(this.commandName)},CommandPatch.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},CommandPatch}},{}],98:[function(require,module){"use strict";module.exports=function(scribe){function Command(commandName){this.commandName=commandName,this.patch=scribe.commandPatches[this.commandName]}return Command.prototype.execute=function(value){this.patch?this.patch.execute(value):scribe.transactionManager.run(function(){document.execCommand(this.commandName,!1,value||null)}.bind(this))},Command.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},Command.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},Command}},{}],99:[function(require,module){"use strict";function Node(node){this.node=node}Node.prototype.getAncestor=function(nodeFilter){var isTopContainerElement=function(element){return element&&element.attributes&&element.attributes.getNamedItem("contenteditable")};if(!isTopContainerElement(this.node))for(var currentNode=this.node.parentNode;currentNode&&!isTopContainerElement(currentNode);){if(nodeFilter(currentNode))return currentNode;currentNode=currentNode.parentNode}},Node.prototype.nextAll=function(){for(var all=[],el=this.node.nextSibling;el;)all.push(el),el=el.nextSibling;return all},module.exports=Node},{}],100:[function(require,module){require("../element");module.exports=function(scribe){function Selection(){this.selection=window.getSelection(),this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}return Selection.prototype.getContaining=function(nodeFilter){var range=this.range;if(range){var node=new scribe.api.Node(this.range.commonAncestorContainer),isTopContainerElement=node.node&&node.node.attributes&&node.node.attributes.getNamedItem("contenteditable");return!isTopContainerElement&&nodeFilter(node.node)?node.node:node.getAncestor(nodeFilter)}},Selection.prototype.placeMarkers=function(){var range=this.range;if(range){var startMarker=document.createElement("em");startMarker.classList.add("scribe-marker");var endMarker=document.createElement("em");endMarker.classList.add("scribe-marker");var rangeEnd=this.range.cloneRange();if(rangeEnd.collapse(!1),rangeEnd.insertNode(endMarker),endMarker.nextSibling&&endMarker.nextSibling.nodeType===Node.TEXT_NODE&&""===endMarker.nextSibling.data&&endMarker.parentNode.removeChild(endMarker.nextSibling),endMarker.previousSibling&&endMarker.previousSibling.nodeType===Node.TEXT_NODE&&""===endMarker.previousSibling.data&&endMarker.parentNode.removeChild(endMarker.previousSibling),!this.selection.isCollapsed){var rangeStart=this.range.cloneRange();rangeStart.collapse(!0),rangeStart.insertNode(startMarker),startMarker.nextSibling&&startMarker.nextSibling.nodeType===Node.TEXT_NODE&&""===startMarker.nextSibling.data&&startMarker.parentNode.removeChild(startMarker.nextSibling),startMarker.previousSibling&&startMarker.previousSibling.nodeType===Node.TEXT_NODE&&""===startMarker.previousSibling.data&&startMarker.parentNode.removeChild(startMarker.previousSibling)}this.selection.removeAllRanges(),this.selection.addRange(this.range)}},Selection.prototype.getMarkers=function(){return scribe.el.querySelectorAll("em.scribe-marker")},Selection.prototype.removeMarkers=function(){var markers=this.getMarkers();Array.prototype.forEach.call(markers,function(marker){marker.parentNode.removeChild(marker)})},Selection.prototype.selectMarkers=function(keepMarkers){var markers=this.getMarkers();if(markers.length){var newRange=document.createRange();newRange.setStartBefore(markers[0]),newRange.setEndAfter(markers.length>=2?markers[1]:markers[0]),keepMarkers||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(newRange)}},Selection.prototype.isCaretOnNewLine=function(){function isEmptyInlineElement(node){for(var treeWalker=document.createTreeWalker(node,NodeFilter.SHOW_ELEMENT),currentNode=treeWalker.root;currentNode;){var numberOfChildren=currentNode.childNodes.length;if(numberOfChildren>1||1===numberOfChildren&&""!==currentNode.textContent.trim())return!1;if(0===numberOfChildren)return""===currentNode.textContent.trim();currentNode=treeWalker.nextNode()}}var containerPElement=this.getContaining(function(node){return"P"===node.nodeName});return containerPElement?isEmptyInlineElement(containerPElement):!1},Selection}},{"../element":103}],101:[function(require,module){"use strict";module.exports=function(api,scribe){function SimpleCommand(commandName,nodeName){scribe.api.Command.call(this,commandName),this.nodeName=nodeName}return SimpleCommand.prototype=Object.create(api.Command.prototype),SimpleCommand.prototype.constructor=SimpleCommand,SimpleCommand.prototype.queryState=function(){var selection=new scribe.api.Selection;return scribe.api.Command.prototype.queryState.call(this)&&!!selection.getContaining(function(node){return node.nodeName===this.nodeName}.bind(this))},SimpleCommand}},{}],102:[function(require,module){function observeDomChanges(el,callback){function includeRealMutations(mutations){var allChangedNodes=flatten(mutations.map(function(mutation){var added=toArray(mutation.addedNodes),removed=toArray(mutation.removedNodes);return added.concat(removed)})),realChangedNodes=allChangedNodes.filter(function(n){return!nodeHelpers.isEmptyTextNode(n)}).filter(function(n){return!elementHelpers.isSelectionMarkerNode(n)});return realChangedNodes.length>0}var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,runningPostMutation=!1,observer=new MutationObserver(function(mutations){if(!runningPostMutation&&includeRealMutations(mutations)){runningPostMutation=!0;try{callback()}catch(e){throw e}finally{setTimeout(function(){runningPostMutation=!1},0)}}});return observer.observe(el,{attributes:!0,childList:!0,subtree:!0}),observer}var flatten=require("lodash-amd/modern/arrays/flatten"),toArray=require("lodash-amd/modern/collections/toArray"),elementHelpers=require("./element"),nodeHelpers=require("./node");module.exports=observeDomChanges},{"./element":103,"./node":105,"lodash-amd/modern/arrays/flatten":52,"lodash-amd/modern/collections/toArray":57}],103:[function(require,module){function isBlockElement(node){return contains(blockElementNames,node.nodeName)}function isSelectionMarkerNode(node){return node.nodeType===Node.ELEMENT_NODE&&"scribe-marker"===node.className}function isCaretPositionNode(node){return node.nodeType===Node.ELEMENT_NODE&&"caret-position"===node.className}function unwrap(node,childNode){for(;childNode.childNodes.length>0;)node.insertBefore(childNode.childNodes[0],childNode);node.removeChild(childNode)}var contains=require("lodash-amd/modern/collections/contains"),blockElementNames=["P","LI","DIV","BLOCKQUOTE","UL","OL","H1","H2","H3","H4","H5","H6","TABLE","TH","TD"];module.exports={isBlockElement:isBlockElement,isSelectionMarkerNode:isSelectionMarkerNode,isCaretPositionNode:isCaretPositionNode,unwrap:unwrap}},{"lodash-amd/modern/collections/contains":55}],104:[function(require,module){function EventEmitter(){this._listeners={}}var pull=require("lodash-amd/modern/arrays/pull");EventEmitter.prototype.on=function(eventName,fn){var listeners=this._listeners[eventName]||[];listeners.push(fn),this._listeners[eventName]=listeners},EventEmitter.prototype.off=function(eventName,fn){var listeners=this._listeners[eventName]||[];fn?pull(listeners,fn):delete this._listeners[eventName]},EventEmitter.prototype.trigger=function(eventName,args){var listeners=this._listeners[eventName]||[];listeners.forEach(function(listener){listener.apply(null,args)})},module.exports=EventEmitter},{"lodash-amd/modern/arrays/pull":54}],105:[function(require,module){"use strict";function isEmptyTextNode(node){return node.nodeType===Node.TEXT_NODE&&""===node.textContent}function insertAfter(newNode,referenceNode){return referenceNode.parentNode.insertBefore(newNode,referenceNode.nextSibling)}function removeNode(node){return node.parentNode.removeChild(node)}module.exports={isEmptyTextNode:isEmptyTextNode,insertAfter:insertAfter,removeNode:removeNode}},{}],106:[function(require,module){var indent=require("./commands/indent"),insertList=require("./commands/insert-list"),outdent=require("./commands/outdent"),redo=require("./commands/redo"),subscript=require("./commands/subscript"),superscript=require("./commands/superscript"),undo=require("./commands/undo");module.exports={indent:indent,insertList:insertList,outdent:outdent,redo:redo,subscript:subscript,superscript:superscript,undo:undo}},{"./commands/indent":107,"./commands/insert-list":108,"./commands/outdent":109,"./commands/redo":110,"./commands/subscript":111,"./commands/superscript":112,"./commands/undo":113}],107:[function(require,module){"use strict";module.exports=function(){return function(scribe){var indentCommand=new scribe.api.Command("indent");indentCommand.queryEnabled=function(){var selection=new scribe.api.Selection,listElement=selection.getContaining(function(element){return"UL"===element.nodeName||"OL"===element.nodeName});return scribe.api.Command.prototype.queryEnabled.call(this)&&scribe.allowsBlockElements()&&!listElement},scribe.commands.indent=indentCommand}}},{}],108:[function(require,module){"use strict";module.exports=function(){return function(scribe){var InsertListCommand=function(commandName){scribe.api.Command.call(this,commandName)};InsertListCommand.prototype=Object.create(scribe.api.Command.prototype),InsertListCommand.prototype.constructor=InsertListCommand,InsertListCommand.prototype.execute=function(value){function splitList(listItemElements){if(listItemElements.length>0){var newListNode=document.createElement(listNode.nodeName);listItemElements.forEach(function(listItemElement){newListNode.appendChild(listItemElement)}),listNode.parentNode.insertBefore(newListNode,listNode.nextElementSibling)}}if(this.queryState()){var selection=new scribe.api.Selection,range=selection.range,listNode=selection.getContaining(function(node){return"OL"===node.nodeName||"UL"===node.nodeName}),listItemElement=selection.getContaining(function(node){return"LI"===node.nodeName});scribe.transactionManager.run(function(){if(listItemElement){var nextListItemElements=new scribe.api.Node(listItemElement).nextAll();splitList(nextListItemElements),selection.placeMarkers();var pNode=document.createElement("p");pNode.innerHTML=listItemElement.innerHTML,listNode.parentNode.insertBefore(pNode,listNode.nextElementSibling),listItemElement.parentNode.removeChild(listItemElement)}else{var selectedListItemElements=Array.prototype.map.call(listNode.querySelectorAll("li"),function(listItemElement){return range.intersectsNode(listItemElement)&&listItemElement}).filter(function(listItemElement){return listItemElement}),lastSelectedListItemElement=selectedListItemElements.slice(-1)[0],listItemElementsAfterSelection=new scribe.api.Node(lastSelectedListItemElement).nextAll();splitList(listItemElementsAfterSelection),selection.placeMarkers();var documentFragment=document.createDocumentFragment();selectedListItemElements.forEach(function(listItemElement){var pElement=document.createElement("p");pElement.innerHTML=listItemElement.innerHTML,documentFragment.appendChild(pElement)}),listNode.parentNode.insertBefore(documentFragment,listNode.nextElementSibling),selectedListItemElements.forEach(function(listItemElement){listItemElement.parentNode.removeChild(listItemElement)})}0===listNode.childNodes.length&&listNode.parentNode.removeChild(listNode),selection.selectMarkers()}.bind(this))}else scribe.api.Command.prototype.execute.call(this,value)},InsertListCommand.prototype.queryEnabled=function(){return scribe.api.Command.prototype.queryEnabled.call(this)&&scribe.allowsBlockElements()
},scribe.commands.insertOrderedList=new InsertListCommand("insertOrderedList"),scribe.commands.insertUnorderedList=new InsertListCommand("insertUnorderedList")}}},{}],109:[function(require,module){"use strict";module.exports=function(){return function(scribe){var outdentCommand=new scribe.api.Command("outdent");outdentCommand.queryEnabled=function(){var selection=new scribe.api.Selection,listElement=selection.getContaining(function(element){return"UL"===element.nodeName||"OL"===element.nodeName});return scribe.api.Command.prototype.queryEnabled.call(this)&&scribe.allowsBlockElements()&&!listElement},scribe.commands.outdent=outdentCommand}}},{}],110:[function(require,module){"use strict";module.exports=function(){return function(scribe){var redoCommand=new scribe.api.Command("redo");redoCommand.execute=function(){var historyItem=scribe.undoManager.redo();"undefined"!=typeof historyItem&&scribe.restoreFromHistory(historyItem)},redoCommand.queryEnabled=function(){return scribe.undoManager.position<scribe.undoManager.stack.length-1},scribe.commands.redo=redoCommand,scribe.el.addEventListener("keydown",function(event){event.shiftKey&&(event.metaKey||event.ctrlKey)&&90===event.keyCode&&(event.preventDefault(),redoCommand.execute())})}}},{}],111:[function(require,module){"use strict";module.exports=function(){return function(scribe){var subscriptCommand=new scribe.api.Command("subscript");scribe.commands.subscript=subscriptCommand}}},{}],112:[function(require,module){"use strict";module.exports=function(){return function(scribe){var superscriptCommand=new scribe.api.Command("superscript");scribe.commands.superscript=superscriptCommand}}},{}],113:[function(require,module){"use strict";module.exports=function(){return function(scribe){var undoCommand=new scribe.api.Command("undo");undoCommand.execute=function(){var historyItem=scribe.undoManager.undo();"undefined"!=typeof historyItem&&scribe.restoreFromHistory(historyItem)},undoCommand.queryEnabled=function(){return scribe.undoManager.position>1},scribe.commands.undo=undoCommand,scribe.el.addEventListener("keydown",function(event){event.shiftKey||!event.metaKey&&!event.ctrlKey||90!==event.keyCode||(event.preventDefault(),undoCommand.execute())})}}},{}],114:[function(require,module){var contains=require("lodash-amd/modern/collections/contains"),observeDomChanges=require("../../dom-observer");module.exports=function(){return function(scribe){var pushHistoryOnFocus=function(){setTimeout(function(){scribe.pushHistory()}.bind(scribe),0),scribe.el.removeEventListener("focus",pushHistoryOnFocus)}.bind(scribe);scribe.el.addEventListener("focus",pushHistoryOnFocus),scribe.el.addEventListener("focus",function(){function getFirstDeepestChild(node){var treeWalker=document.createTreeWalker(node),previousNode=treeWalker.currentNode;return treeWalker.firstChild()?"BR"===treeWalker.currentNode.nodeName?previousNode:getFirstDeepestChild(treeWalker.currentNode):treeWalker.currentNode}var selection=new scribe.api.Selection;if(selection.range){var isFirefoxBug=scribe.allowsBlockElements()&&selection.range.startContainer===scribe.el;if(isFirefoxBug){var focusElement=getFirstDeepestChild(scribe.el.firstChild),range=selection.range;range.setStart(focusElement,0),range.setEnd(focusElement,0),selection.selection.removeAllRanges(),selection.selection.addRange(range)}}}.bind(scribe));var applyFormatters=function(){if(!scribe._skipFormatters){var selection=new scribe.api.Selection,isEditorActive=selection.range,runFormatters=function(){isEditorActive&&selection.placeMarkers(),scribe.setHTML(scribe._htmlFormatterFactory.format(scribe.getHTML())),selection.selectMarkers()}.bind(scribe);isEditorActive?(scribe.undoManager.undo(),scribe.transactionManager.run(runFormatters)):runFormatters()}delete scribe._skipFormatters}.bind(scribe);observeDomChanges(scribe.el,applyFormatters),scribe.allowsBlockElements()&&scribe.el.addEventListener("keydown",function(event){if(13===event.keyCode){var selection=new scribe.api.Selection,range=selection.range,headingNode=selection.getContaining(function(node){return/^(H[1-6])$/.test(node.nodeName)});if(headingNode&&range.collapsed){var contentToEndRange=range.cloneRange();contentToEndRange.setEndAfter(headingNode,0);var contentToEndFragment=contentToEndRange.cloneContents();""===contentToEndFragment.firstChild.textContent&&(event.preventDefault(),scribe.transactionManager.run(function(){var pNode=document.createElement("p"),brNode=document.createElement("br");pNode.appendChild(brNode),headingNode.parentNode.insertBefore(pNode,headingNode.nextElementSibling),range.setStart(pNode,0),range.setEnd(pNode,0),selection.selection.removeAllRanges(),selection.selection.addRange(range)}))}}}),scribe.allowsBlockElements()&&scribe.el.addEventListener("keydown",function(event){if(13===event.keyCode||8===event.keyCode){var selection=new scribe.api.Selection,range=selection.range;if(range.collapsed){var containerLIElement=selection.getContaining(function(node){return"LI"===node.nodeName});if(containerLIElement&&""===containerLIElement.textContent.trim()){event.preventDefault();var listNode=selection.getContaining(function(node){return"UL"===node.nodeName||"OL"===node.nodeName}),command=scribe.getCommand("OL"===listNode.nodeName?"insertOrderedList":"insertUnorderedList");command.execute()}}}}),scribe.el.addEventListener("paste",function(event){if(event.clipboardData)event.preventDefault(),contains(event.clipboardData.types,"text/html")?scribe.insertHTML(event.clipboardData.getData("text/html")):scribe.insertPlainText(event.clipboardData.getData("text/plain"));else{var selection=new scribe.api.Selection;selection.placeMarkers();var bin=document.createElement("div");document.body.appendChild(bin),bin.setAttribute("contenteditable",!0),bin.focus(),setTimeout(function(){var data=bin.innerHTML;bin.parentNode.removeChild(bin),selection.selectMarkers(),scribe.el.focus(),scribe.insertHTML(data)},1)}})}}},{"../../dom-observer":102,"lodash-amd/modern/collections/contains":55}],115:[function(require,module){function wrapChildNodes(scribe,parentNode){var groups=Array.prototype.reduce.call(parentNode.childNodes,function(accumulator,binChildNode){function startNewGroup(){var newGroup=[binChildNode];accumulator.push(newGroup)}var group=last(accumulator);if(group){var isBlockGroup=scribe.element.isBlockElement(group[0]);isBlockGroup===scribe.element.isBlockElement(binChildNode)?group.push(binChildNode):startNewGroup()}else startNewGroup();return accumulator},[]),consecutiveInlineElementsAndTextNodes=groups.filter(function(group){var isBlockGroup=scribe.element.isBlockElement(group[0]);return!isBlockGroup});consecutiveInlineElementsAndTextNodes.forEach(function(nodes){var pElement=document.createElement("p");nodes[0].parentNode.insertBefore(pElement,nodes[0]),nodes.forEach(function(node){pElement.appendChild(node)})}),parentNode._isWrapped=!0}function traverse(scribe,parentNode){for(var treeWalker=document.createTreeWalker(parentNode,NodeFilter.SHOW_ELEMENT),node=treeWalker.firstChild();node;){if("BLOCKQUOTE"===node.nodeName&&!node._isWrapped){wrapChildNodes(scribe,node),traverse(scribe,parentNode);break}node=treeWalker.nextSibling()}}var last=require("lodash-amd/modern/arrays/last");module.exports=function(){return function(scribe){scribe.registerHTMLFormatter("normalize",function(html){var bin=document.createElement("div");return bin.innerHTML=html,wrapChildNodes(scribe,bin),traverse(scribe,bin),bin.innerHTML})}}},{"lodash-amd/modern/arrays/last":53}],116:[function(require,module){function parentHasNoTextContent(element,node){return element.isCaretPositionNode(node)?!0:""===node.parentNode.textContent.trim()}function traverse(element,parentNode){function isEmpty(node){return 0===node.children.length&&element.isBlockElement(node)||1===node.children.length&&element.isSelectionMarkerNode(node.children[0])?!0:element.isBlockElement(node)||0!==node.children.length?!1:parentHasNoTextContent(element,node)}for(var node=parentNode.firstElementChild;node;)element.isSelectionMarkerNode(node)||(isEmpty(node)&&""===node.textContent.trim()&&!contains(html5VoidElements,node.nodeName)?node.appendChild(document.createElement("br")):node.children.length>0&&traverse(element,node)),node=node.nextElementSibling}var contains=(require("../../../../element"),require("lodash-amd/modern/collections/contains")),html5VoidElements=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];module.exports=function(){return function(scribe){scribe.registerHTMLFormatter("normalize",function(html){var bin=document.createElement("div");return bin.innerHTML=html,traverse(scribe.element,bin),bin.innerHTML})}}},{"../../../../element":103,"lodash-amd/modern/collections/contains":55}],117:[function(require,module){"use strict";module.exports=function(){return function(scribe){var nbspCharRegExp=/(\s|&nbsp;)+/g;scribe.registerHTMLFormatter("export",function(html){return html.replace(nbspCharRegExp," ")})}}},{}],118:[function(require,module){var escape=require("lodash-amd/modern/utilities/escape");module.exports=function(){return function(scribe){scribe.registerPlainTextFormatter(escape)}}},{"lodash-amd/modern/utilities/escape":92}],119:[function(require,module){"use strict";function hasContent(rootNode){for(var treeWalker=document.createTreeWalker(rootNode);treeWalker.nextNode();)if(treeWalker.currentNode&&(~["br"].indexOf(treeWalker.currentNode.nodeName.toLowerCase())||treeWalker.currentNode.length>0))return!0;return!1}module.exports=function(){return function(scribe){scribe.el.addEventListener("keydown",function(event){if(13===event.keyCode){var selection=new scribe.api.Selection,range=selection.range,blockNode=selection.getContaining(function(node){return"LI"===node.nodeName||/^(H[1-6])$/.test(node.nodeName)});blockNode||(event.preventDefault(),scribe.transactionManager.run(function(){"BR"===scribe.el.lastChild.nodeName&&scribe.el.removeChild(scribe.el.lastChild);var brNode=document.createElement("br");range.insertNode(brNode),range.collapse(!1);var contentToEndRange=range.cloneRange();contentToEndRange.setEndAfter(scribe.el.lastChild,0);var contentToEndFragment=contentToEndRange.cloneContents();if(!hasContent(contentToEndFragment)){var bogusBrNode=document.createElement("br");range.insertNode(bogusBrNode)}var newRange=range.cloneRange();newRange.setStartAfter(brNode,0),newRange.setEndAfter(brNode,0),selection.selection.removeAllRanges(),selection.selection.addRange(newRange)}))}}.bind(this)),""===scribe.getHTML().trim()&&scribe.setContent("")}}},{}],120:[function(require,module){var boldCommand=require("./patches/commands/bold"),indentCommand=require("./patches/commands/indent"),insertHTMLCommand=require("./patches/commands/insert-html"),insertListCommands=require("./patches/commands/insert-list"),outdentCommand=require("./patches/commands/outdent"),createLinkCommand=require("./patches/commands/create-link"),events=require("./patches/events");module.exports={commands:{bold:boldCommand,indent:indentCommand,insertHTML:insertHTMLCommand,insertList:insertListCommands,outdent:outdentCommand,createLink:createLinkCommand},events:events}},{"./patches/commands/bold":121,"./patches/commands/create-link":122,"./patches/commands/indent":123,"./patches/commands/insert-html":124,"./patches/commands/insert-list":125,"./patches/commands/outdent":126,"./patches/events":127}],121:[function(require,module){"use strict";module.exports=function(){return function(scribe){var boldCommand=new scribe.api.CommandPatch("bold");boldCommand.queryEnabled=function(){var selection=new scribe.api.Selection,headingNode=selection.getContaining(function(node){return/^(H[1-6])$/.test(node.nodeName)});return scribe.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!headingNode},scribe.commandPatches.bold=boldCommand}}},{}],122:[function(require,module){"use strict";module.exports=function(){return function(scribe){var createLinkCommand=new scribe.api.CommandPatch("createLink");scribe.commandPatches.createLink=createLinkCommand,createLinkCommand.execute=function(value){var selection=new scribe.api.Selection;if(selection.selection.isCollapsed){var aElement=document.createElement("a");aElement.setAttribute("href",value),aElement.textContent=value,selection.range.insertNode(aElement);var newRange=document.createRange();newRange.setStartBefore(aElement),newRange.setEndAfter(aElement),selection.selection.removeAllRanges(),selection.selection.addRange(newRange)}else scribe.api.CommandPatch.prototype.execute.call(this,value)}}}},{}],123:[function(require,module){"use strict";var INVISIBLE_CHAR="﻿";module.exports=function(){return function(scribe){var indentCommand=new scribe.api.CommandPatch("indent");indentCommand.execute=function(value){scribe.transactionManager.run(function(){var selection=new scribe.api.Selection,range=selection.range,isCaretOnNewLine="P"===range.commonAncestorContainer.nodeName&&"<br>"===range.commonAncestorContainer.innerHTML;if(isCaretOnNewLine){var textNode=document.createTextNode(INVISIBLE_CHAR);range.insertNode(textNode),range.setStart(textNode,0),range.setEnd(textNode,0),selection.selection.removeAllRanges(),selection.selection.addRange(range)}scribe.api.CommandPatch.prototype.execute.call(this,value),selection=new scribe.api.Selection;var blockquoteNode=selection.getContaining(function(node){return"BLOCKQUOTE"===node.nodeName});blockquoteNode&&blockquoteNode.removeAttribute("style")}.bind(this))},scribe.commandPatches.indent=indentCommand}}},{}],124:[function(require,module){"use strict";module.exports=function(){return function(scribe){var insertHTMLCommandPatch=new scribe.api.CommandPatch("insertHTML"),element=scribe.element;insertHTMLCommandPatch.execute=function(value){scribe.transactionManager.run(function(){function sanitize(parentNode){var treeWalker=document.createTreeWalker(parentNode,NodeFilter.SHOW_ELEMENT),node=treeWalker.firstChild();if(node)do"SPAN"===node.nodeName?element.unwrap(parentNode,node):(node.style.lineHeight=null,""===node.getAttribute("style")&&node.removeAttribute("style")),sanitize(node);while(node=treeWalker.nextSibling())}scribe.api.CommandPatch.prototype.execute.call(this,value),sanitize(scribe.el)}.bind(this))},scribe.commandPatches.insertHTML=insertHTMLCommandPatch}}},{}],125:[function(require,module){"use strict";module.exports=function(){return function(scribe){var element=scribe.element,nodeHelpers=scribe.node,InsertListCommandPatch=function(commandName){scribe.api.CommandPatch.call(this,commandName)};InsertListCommandPatch.prototype=Object.create(scribe.api.CommandPatch.prototype),InsertListCommandPatch.prototype.constructor=InsertListCommandPatch,InsertListCommandPatch.prototype.execute=function(value){scribe.transactionManager.run(function(){if(scribe.api.CommandPatch.prototype.execute.call(this,value),this.queryState()){var selection=new scribe.api.Selection,listElement=selection.getContaining(function(node){return"OL"===node.nodeName||"UL"===node.nodeName});if(listElement.nextElementSibling&&0===listElement.nextElementSibling.childNodes.length&&nodeHelpers.removeNode(listElement.nextElementSibling),listElement){var listParentNode=listElement.parentNode;listParentNode&&/^(H[1-6]|P)$/.test(listParentNode.nodeName)&&(selection.placeMarkers(),nodeHelpers.insertAfter(listElement,listParentNode),selection.selectMarkers(),2===listParentNode.childNodes.length&&nodeHelpers.isEmptyTextNode(listParentNode.firstChild)&&nodeHelpers.removeNode(listParentNode),0===listParentNode.childNodes.length&&nodeHelpers.removeNode(listParentNode))}var listItemElements=Array.prototype.slice.call(listElement.childNodes);listItemElements.forEach(function(listItemElement){var listItemElementChildNodes=Array.prototype.slice.call(listItemElement.childNodes);listItemElementChildNodes.forEach(function(listElementChildNode){if("SPAN"===listElementChildNode.nodeName){var spanElement=listElementChildNode;element.unwrap(listItemElement,spanElement)}else listElementChildNode.nodeType===Node.ELEMENT_NODE&&(listElementChildNode.style.lineHeight=null,""===listElementChildNode.getAttribute("style")&&listElementChildNode.removeAttribute("style"))})})}}.bind(this))},scribe.commandPatches.insertOrderedList=new InsertListCommandPatch("insertOrderedList"),scribe.commandPatches.insertUnorderedList=new InsertListCommandPatch("insertUnorderedList")}}},{}],126:[function(require,module){"use strict";module.exports=function(){return function(scribe){var outdentCommand=new scribe.api.CommandPatch("outdent");outdentCommand.execute=function(){scribe.transactionManager.run(function(){var selection=new scribe.api.Selection,range=selection.range,blockquoteNode=selection.getContaining(function(node){return"BLOCKQUOTE"===node.nodeName});if("BLOCKQUOTE"===range.commonAncestorContainer.nodeName){selection.placeMarkers(),selection.selectMarkers(!0);var selectedNodes=range.cloneContents();blockquoteNode.parentNode.insertBefore(selectedNodes,blockquoteNode),range.deleteContents(),selection.selectMarkers(),""===blockquoteNode.textContent&&blockquoteNode.parentNode.removeChild(blockquoteNode)}else{var pNode=selection.getContaining(function(node){return"P"===node.nodeName});if(pNode){var nextSiblingNodes=new scribe.api.Node(pNode).nextAll();if(nextSiblingNodes.length){var newContainerNode=document.createElement(blockquoteNode.nodeName);nextSiblingNodes.forEach(function(siblingNode){newContainerNode.appendChild(siblingNode)}),blockquoteNode.parentNode.insertBefore(newContainerNode,blockquoteNode.nextElementSibling)}selection.placeMarkers(),blockquoteNode.parentNode.insertBefore(pNode,blockquoteNode.nextElementSibling),selection.selectMarkers(),""===blockquoteNode.innerHTML&&blockquoteNode.parentNode.removeChild(blockquoteNode)}else scribe.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},scribe.commandPatches.outdent=outdentCommand}}},{}],127:[function(require,module){"use strict";module.exports=function(){return function(scribe){var element=scribe.element;scribe.allowsBlockElements()&&scribe.el.addEventListener("keyup",function(event){if(8===event.keyCode||46===event.keyCode){var selection=new scribe.api.Selection,containerPElement=selection.getContaining(function(node){return"P"===node.nodeName});containerPElement&&(scribe.undoManager.undo(),scribe.transactionManager.run(function(){selection.placeMarkers();var pElementChildNodes=Array.prototype.slice.call(containerPElement.childNodes);pElementChildNodes.forEach(function(pElementChildNode){if("SPAN"===pElementChildNode.nodeName){var spanElement=pElementChildNode;element.unwrap(containerPElement,spanElement)}else pElementChildNode.nodeType===Node.ELEMENT_NODE&&(pElementChildNode.style.lineHeight=null,""===pElementChildNode.getAttribute("style")&&pElementChildNode.removeAttribute("style"))}),selection.selectMarkers()}))}})}}},{}],128:[function(require,module){"use strict";module.exports=function(){return function(scribe){""===scribe.getHTML().trim()&&scribe.setContent("<p><br></p>")}}},{}],129:[function(require,module){function Scribe(el,options){EventEmitter.call(this),this.el=el,this.commands={},this.options=defaults(options||{},{allowBlockElements:!0,debug:!1}),this.commandPatches={},this._plainTextFormatterFactory=new FormatterFactory,this._htmlFormatterFactory=new HTMLFormatterFactory,this.api=new Api(this),this.node=nodeHelpers,this.element=elementHelpers;var TransactionManager=buildTransactionManager(this);this.transactionManager=new TransactionManager;var UndoManager=buildUndoManager(this);this.undoManager=new UndoManager,this.el.setAttribute("contenteditable",!0),this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1),this.allowsBlockElements()?(this.use(setRootPElement()),this.use(enforcePElements()),this.use(ensureSelectableContainers())):this.use(inlineElementsMode()),this.use(escapeHtmlCharactersFormatter()),this.use(replaceNbspCharsFormatter());var mandatoryPatches=[patches.commands.bold,patches.commands.indent,patches.commands.insertHTML,patches.commands.insertList,patches.commands.outdent,patches.commands.createLink,patches.events],mandatoryCommands=[commands.indent,commands.insertList,commands.outdent,commands.redo,commands.subscript,commands.superscript,commands.undo],allPlugins=[].concat(mandatoryPatches,mandatoryCommands);allPlugins.forEach(function(plugin){this.use(plugin())}.bind(this)),this.use(events())}function FormatterFactory(){this.formatters=[]}function HTMLFormatterFactory(){this.formatters={sanitize:[],normalize:[],"export":[]}}var defaults=require("lodash-amd/modern/objects/defaults"),flatten=require("lodash-amd/modern/arrays/flatten"),commands=require("./plugins/core/commands"),events=require("./plugins/core/events"),replaceNbspCharsFormatter=require("./plugins/core/formatters/html/replace-nbsp-chars"),enforcePElements=require("./plugins/core/formatters/html/enforce-p-elements"),ensureSelectableContainers=require("./plugins/core/formatters/html/ensure-selectable-containers"),escapeHtmlCharactersFormatter=require("./plugins/core/formatters/plain-text/escape-html-characters"),inlineElementsMode=require("./plugins/core/inline-elements-mode"),patches=require("./plugins/core/patches"),setRootPElement=require("./plugins/core/set-root-p-element"),Api=require("./api"),buildTransactionManager=require("./transaction-manager"),buildUndoManager=require("./undo-manager"),EventEmitter=require("./event-emitter"),elementHelpers=require("./element"),nodeHelpers=require("./node");Scribe.prototype=Object.create(EventEmitter.prototype),Scribe.prototype.use=function(configurePlugin){return configurePlugin(this),this},Scribe.prototype.setHTML=function(html,skipFormatters){skipFormatters&&(this._skipFormatters=!0),this.el.innerHTML=html},Scribe.prototype.getHTML=function(){return this.el.innerHTML},Scribe.prototype.getContent=function(){return this._htmlFormatterFactory.formatForExport(this.getHTML().replace(/<br>$/,""))},Scribe.prototype.getTextContent=function(){return this.el.textContent},Scribe.prototype.pushHistory=function(){var previousUndoItem=this.undoManager.stack[this.undoManager.position],previousContent=previousUndoItem&&previousUndoItem.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");if(!previousUndoItem||previousUndoItem&&this.getHTML()!==previousContent){var selection=new this.api.Selection;selection.placeMarkers();var html=this.getHTML();return selection.removeMarkers(),this.undoManager.push(html),!0}return!1},Scribe.prototype.getCommand=function(commandName){return this.commands[commandName]||this.commandPatches[commandName]||new this.api.Command(commandName)},Scribe.prototype.restoreFromHistory=function(historyItem){this.setHTML(historyItem,!0);var selection=new this.api.Selection;selection.selectMarkers(),this.trigger("content-changed")},Scribe.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},Scribe.prototype.setContent=function(content){this.allowsBlockElements()||(content+="<br>"),this.setHTML(content),this.trigger("content-changed")},Scribe.prototype.insertPlainText=function(plainText){this.insertHTML("<p>"+this._plainTextFormatterFactory.format(plainText)+"</p>")},Scribe.prototype.insertHTML=function(html){this.getCommand("insertHTML").execute(this._htmlFormatterFactory.format(html))},Scribe.prototype.isDebugModeEnabled=function(){return this.options.debug},Scribe.prototype.registerHTMLFormatter=function(phase,fn){this._htmlFormatterFactory.formatters[phase].push(fn)},Scribe.prototype.registerPlainTextFormatter=function(fn){this._plainTextFormatterFactory.formatters.push(fn)},FormatterFactory.prototype.format=function(html){var formatted=this.formatters.reduce(function(formattedData,formatter){return formatter(formattedData)},html);return formatted},HTMLFormatterFactory.prototype=Object.create(FormatterFactory.prototype),HTMLFormatterFactory.prototype.constructor=HTMLFormatterFactory,HTMLFormatterFactory.prototype.format=function(html){var formatters=flatten([this.formatters.sanitize,this.formatters.normalize]),formatted=formatters.reduce(function(formattedData,formatter){return formatter(formattedData)},html);return formatted},HTMLFormatterFactory.prototype.formatForExport=function(html){return this.formatters["export"].reduce(function(formattedData,formatter){return formatter(formattedData)},html)},module.exports=Scribe},{"./api":96,"./element":103,"./event-emitter":104,"./node":105,"./plugins/core/commands":106,"./plugins/core/events":114,"./plugins/core/formatters/html/enforce-p-elements":115,"./plugins/core/formatters/html/ensure-selectable-containers":116,"./plugins/core/formatters/html/replace-nbsp-chars":117,"./plugins/core/formatters/plain-text/escape-html-characters":118,"./plugins/core/inline-elements-mode":119,"./plugins/core/patches":120,"./plugins/core/set-root-p-element":128,"./transaction-manager":130,"./undo-manager":131,"lodash-amd/modern/arrays/flatten":52,"lodash-amd/modern/objects/defaults":81}],130:[function(require,module){var assign=require("lodash-amd/modern/objects/assign");module.exports=function(scribe){function TransactionManager(){this.history=[]}return assign(TransactionManager.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),0===this.history.length&&(scribe.pushHistory(),scribe.trigger("content-changed"))},run:function(transaction){this.start();try{transaction&&transaction()}finally{this.end()}}}),TransactionManager}},{"lodash-amd/modern/objects/assign":80}],131:[function(require,module){"use strict";module.exports=function(scribe){function UndoManager(){this.position=-1,this.stack=[],this.debug=scribe.isDebugModeEnabled()}return UndoManager.prototype.maxStackSize=100,UndoManager.prototype.push=function(item){for(this.debug&&console.log("UndoManager.push: %s",item),this.stack.length=++this.position,this.stack.push(item);this.stack.length>this.maxStackSize;)this.stack.shift(),--this.position},UndoManager.prototype.undo=function(){return this.position>0?this.stack[--this.position]:void 0},UndoManager.prototype.redo=function(){return this.position<this.stack.length-1?this.stack[++this.position]:void 0},UndoManager}},{}],132:[function(require,module){"use strict";module.exports=function(){return function(scribe){scribe.registerPlainTextFormatter(function(html){return html.replace(/\n([ \t]*\n)+/g,"</p><p>").replace(/\n/g,"<br>")})}}},{}],133:[function(require,module){"use strict";module.exports=function(){return function(scribe){var linkPromptCommand=new scribe.api.Command("createLink");linkPromptCommand.nodeName="A",linkPromptCommand.execute=function(){var selection=new scribe.api.Selection,range=selection.range,anchorNode=selection.getContaining(function(node){return node.nodeName===this.nodeName}.bind(this)),initialLink=anchorNode?anchorNode.href:"http://",link=window.prompt("Enter a link.",initialLink);if(anchorNode&&(range.selectNode(anchorNode),selection.selection.removeAllRanges(),selection.selection.addRange(range)),link){var urlProtocolRegExp=/^https?\:\/\//;if(!urlProtocolRegExp.test(link))if(!/^mailto\:/.test(link)&&/@/.test(link)){var shouldPrefixEmail=window.confirm("The URL you entered appears to be an email address. Do you want to add the required “mailto:” prefix?");shouldPrefixEmail&&(link="mailto:"+link)}else{var shouldPrefixLink=window.confirm("The URL you entered appears to be a link. Do you want to add the required “http://” prefix?");shouldPrefixLink&&(link="http://"+link)}scribe.api.SimpleCommand.prototype.execute.call(this,link)}},linkPromptCommand.queryState=function(){var selection=new scribe.api.Selection;return!!selection.getContaining(function(node){return node.nodeName===this.nodeName}.bind(this))},scribe.commands.linkPrompt=linkPromptCommand}}},{}],134:[function(require,module,exports){!function(root,factory){"object"==typeof exports?module.exports=factory():"function"==typeof define&&define.amd?define(factory):root.Spinner=factory()}(this,function(){"use strict";function createEl(tag,prop){var n,el=document.createElement(tag||"div");for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;n>i;i++)parent.appendChild(arguments[i]);return parent}function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(100*alpha),i,lines].join("-"),start=.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";return animations[name]||(sheet.insertRule("@"+pre+"keyframes "+name+"{0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}100%{opacity:"+z+"}}",sheet.cssRules.length),animations[name]=1),name}function vendor(el,prop){var pp,i,s=el.style;for(prop=prop.charAt(0).toUpperCase()+prop.slice(1),i=0;i<prefixes.length;i++)if(pp=prefixes[i]+prop,void 0!==s[pp])return pp;return void 0!==s[prop]?prop:void 0}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def)void 0===obj[n]&&(obj[n]=def[n])}return obj}function getColor(color,idx){return"string"==typeof color?color:color[idx%color.length]}function Spinner(o){this.opts=merge(o||{},Spinner.defaults,defaults)}function initVML(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}sheet.addRule(".spin-vml","behavior:url(#default#VML)"),Spinner.prototype.lines=function(el,o){function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:getColor(o.color,i),opacity:o.opacity}),vml("stroke",{opacity:0}))))}var i,r=o.length+o.width,s=2*r,margin=2*-(o.width+o.length)+"px",g=css(grp(),{position:"absolute",top:margin,left:margin});if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)},Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0,c&&i+o<c.childNodes.length&&(c=c.childNodes[i+o],c=c&&c.firstChild,c=c&&c.firstChild,c&&(c.opacity=val))}}var useCssAnimations,prefixes=["webkit","Moz","ms","O"],animations={},sheet=function(){var el=createEl("style",{type:"text/css"});return ins(document.getElementsByTagName("head")[0],el),el.sheet||el.styleSheet}(),defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};Spinner.defaults={},merge(Spinner.prototype,{spin:function(target){this.stop();{var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex});o.radius+o.length+o.width}if(css(el,{left:o.left,top:o.top}),target&&target.insertBefore(el,target.firstChild||null),el.setAttribute("role","progressbar"),self.lines(el,self.opts),!useCssAnimations){var alpha,i=0,start=(o.lines-1)*(1-o.direction)/2,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;!function anim(){i++;for(var j=0;j<o.lines;j++)alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity),self.opacity(el,j*o.direction+start,alpha,o);self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))}()}return self},stop:function(){var el=this.el;return el&&(clearTimeout(this.timeout),el.parentNode&&el.parentNode.removeChild(el),this.el=void 0),this},lines:function(el,o){function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px,0)",borderRadius:(o.corners*o.width>>1)+"px"})
}for(var seg,i=0,start=(o.lines-1)*(1-o.direction)/2;i<o.lines;i++)seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&ins(seg,css(fill("#000","0 0 4px #000"),{top:"2px"})),ins(el,ins(seg,fill(getColor(o.color,i),"0 0 1px rgba(0,0,0,.1)")));return el},opacity:function(el,i,val){i<el.childNodes.length&&(el.childNodes[i].style.opacity=val)}});var probe=css(createEl("group"),{behavior:"url(#default#VML)"});return!vendor(probe,"transform")&&probe.adj?initVML():useCssAnimations=vendor(probe,"animation"),Spinner})},{}],135:[function(require,module){"use strict";var _=require("./lodash"),Blocks=require("./blocks"),BlockControl=function(type){this.type=type,this.block_type=Blocks[this.type].prototype,this.can_be_rendered=this.block_type.toolbarEnabled,this._ensureElement()};Object.assign(BlockControl.prototype,require("./function-bind"),require("./renderable"),require("./events"),{tagName:"a",className:"st-block-control",attributes:function(){return{"data-type":this.block_type.type}},render:function(){return this.$el.html('<span class="st-icon">'+_.result(this.block_type,"icon_name")+"</span>"+_.result(this.block_type,"title")),this}}),module.exports=BlockControl},{"./blocks":153,"./events":163,"./function-bind":170,"./lodash":175,"./renderable":177}],136:[function(require,module){"use strict";var _=require("./lodash"),Blocks=require("./blocks"),BlockControl=require("./block-control"),EventBus=require("./event-bus"),BlockControls=function(available_types,mediator){this.available_types=available_types||[],this.mediator=mediator,this._ensureElement(),this._bindFunctions(),this._bindMediatedEvents(),this.initialize()};Object.assign(BlockControls.prototype,require("./function-bind"),require("./mediated-events"),require("./renderable"),require("./events"),{bound:["handleControlButtonClick"],block_controls:null,className:"st-block-controls",eventNamespace:"block-controls",mediatedEvents:{render:"renderInContainer",show:"show",hide:"hide"},initialize:function(){for(var block_type in this.available_types)if(Blocks.hasOwnProperty(block_type)){var block_control=new BlockControl(block_type);block_control.can_be_rendered&&this.$el.append(block_control.render().$el)}this.$el.delegate(".st-block-control","click",this.handleControlButtonClick),this.mediator.on("block-controls:show",this.renderInContainer)},show:function(){this.$el.addClass("st-block-controls--active"),EventBus.trigger("block:controls:shown")},hide:function(){this.removeCurrentContainer(),this.$el.removeClass("st-block-controls--active"),EventBus.trigger("block:controls:hidden")},handleControlButtonClick:function(e){e.stopPropagation(),this.mediator.trigger("block:create",$(e.currentTarget).attr("data-type"))},renderInContainer:function(container){this.removeCurrentContainer(),container.append(this.$el.detach()),container.addClass("with-st-controls"),this.currentContainer=container,this.show()},removeCurrentContainer:function(){_.isUndefined(this.currentContainer)||(this.currentContainer.removeClass("with-st-controls"),this.currentContainer=void 0)}}),module.exports=BlockControls},{"./block-control":135,"./blocks":153,"./event-bus":162,"./events":163,"./function-bind":170,"./lodash":175,"./mediated-events":176,"./renderable":177}],137:[function(require,module){"use strict";var BlockDeletion=function(){this._ensureElement(),this._bindFunctions()};Object.assign(BlockDeletion.prototype,require("./function-bind"),require("./renderable"),{tagName:"a",className:"st-block-ui-btn st-block-ui-btn--delete st-icon",attributes:{html:"delete","data-icon":"bin"}}),module.exports=BlockDeletion},{"./function-bind":170,"./renderable":177}],138:[function(require,module){"use strict";var _=require("./lodash"),utils=require("./utils"),config=require("./config"),EventBus=require("./event-bus"),Blocks=require("./blocks"),BLOCK_OPTION_KEYS=["convertToMarkdown","convertFromMarkdown","formatBar"],BlockManager=function(options,editorInstance,mediator){this.options=options,this.blockOptions=BLOCK_OPTION_KEYS.reduce(function(acc,key){return acc[key]=options[key],acc},{}),this.instance_scope=editorInstance,this.mediator=mediator,this.blocks=[],this.blockCounts={},this.blockTypes={},this._setBlocksTypes(),this._setRequired(),this._bindMediatedEvents(),this.initialize()};Object.assign(BlockManager.prototype,require("./function-bind"),require("./mediated-events"),require("./events"),{eventNamespace:"block",mediatedEvents:{create:"createBlock",remove:"removeBlock",rerender:"rerenderBlock"},initialize:function(){},createBlock:function(type,data){if(type=utils.classify(type),this.canCreateBlock(type)){var block=new Blocks[type](data,this.instance_scope,this.mediator,this.blockOptions);this.blocks.push(block),this._incrementBlockTypeCount(type),this.mediator.trigger("block:render",block),this.triggerBlockCountUpdate(),this.mediator.trigger("block:limitReached",this.blockLimitReached()),utils.log("Block created of type "+type)}},removeBlock:function(blockID){var block=this.findBlockById(blockID),type=utils.classify(block.type);this.mediator.trigger("block-controls:reset"),this.blocks=this.blocks.filter(function(item){return item.blockID!==block.blockID}),this._decrementBlockTypeCount(type),this.triggerBlockCountUpdate(),this.mediator.trigger("block:limitReached",this.blockLimitReached()),EventBus.trigger("block:remove")},rerenderBlock:function(blockID){var block=this.findBlockById(blockID);_.isUndefined(block)||block.isEmpty()||!block.drop_options.re_render_on_reorder||block.beforeLoadingData()},triggerBlockCountUpdate:function(){this.mediator.trigger("block:countUpdate",this.blocks.length)},canCreateBlock:function(type){return this.blockLimitReached()?(utils.log("Cannot add any more blocks. Limit reached."),!1):this.isBlockTypeAvailable(type)?this.canAddBlockType(type)?!0:(utils.log("Block Limit reached for type "+type),!1):(utils.log("Block type not available "+type),!1)},validateBlockTypesExist:function(shouldValidate){return config.skipValidation||!shouldValidate?!1:void(this.required||[]).forEach(function(type){if(this.isBlockTypeAvailable(type))if(0===this._getBlockTypeCount(type))utils.log("Failed validation on required block type "+type),this.mediator.trigger("errors:add",{text:i18n.t("errors:type_missing",{type:type})});else{var blocks=this.getBlocksByType(type).filter(function(b){return!b.isEmpty()});if(blocks.length>0)return!1;this.mediator.trigger("errors:add",{text:i18n.t("errors:required_type_empty",{type:type})}),utils.log("A required block type "+type+" is empty")}},this)},findBlockById:function(blockID){return this.blocks.find(function(b){return b.blockID===blockID})},getBlocksByType:function(type){return this.blocks.filter(function(b){return utils.classify(b.type)===type})},getBlocksByIDs:function(block_ids){return this.blocks.filter(function(b){return block_ids.includes(b.blockID)})},blockLimitReached:function(){return 0!==this.options.blockLimit&&this.blocks.length>=this.options.blockLimit},isBlockTypeAvailable:function(t){return!_.isUndefined(this.blockTypes[t])},canAddBlockType:function(type){var block_type_limit=this._getBlockTypeLimit(type);return!(0!==block_type_limit&&this._getBlockTypeCount(type)>=block_type_limit)},_setBlocksTypes:function(){this.blockTypes=utils.flatten(_.isUndefined(this.options.blockTypes)?Blocks:this.options.blockTypes)},_setRequired:function(){this.required=!1,Array.isArray(this.options.required)&&!_.isEmpty(this.options.required)&&(this.required=this.options.required)},_incrementBlockTypeCount:function(type){this.blockCounts[type]=_.isUndefined(this.blockCounts[type])?1:this.blockCounts[type]+1},_decrementBlockTypeCount:function(type){this.blockCounts[type]=_.isUndefined(this.blockCounts[type])?1:this.blockCounts[type]-1},_getBlockTypeCount:function(type){return _.isUndefined(this.blockCounts[type])?0:this.blockCounts[type]},_blockLimitReached:function(){return 0!==this.options.blockLimit&&this.blocks.length>=this.options.blockLimit},_getBlockTypeLimit:function(t){return this.isBlockTypeAvailable(t)?parseInt(_.isUndefined(this.options.blockTypeLimits[t])?0:this.options.blockTypeLimits[t],10):0}}),module.exports=BlockManager},{"./blocks":153,"./config":159,"./event-bus":162,"./events":163,"./function-bind":170,"./lodash":175,"./mediated-events":176,"./utils":181}],139:[function(require,module){"use strict";var template=["<div class='st-block-positioner__inner'>","<span class='st-block-positioner__selected-value'></span>","<select class='st-block-positioner__select'></select>","</div>"].join("\n"),BlockPositioner=function(block_element,mediator){this.mediator=mediator,this.$block=block_element,this._ensureElement(),this._bindFunctions(),this.initialize()};Object.assign(BlockPositioner.prototype,require("./function-bind"),require("./renderable"),{total_blocks:0,bound:["onBlockCountChange","onSelectChange","toggle","show","hide"],className:"st-block-positioner",visibleClass:"st-block-positioner--is-visible",initialize:function(){this.$el.append(template),this.$select=this.$(".st-block-positioner__select"),this.$select.on("change",this.onSelectChange),this.mediator.on("blocks:countUpdate",this.onBlockCountChange)},onBlockCountChange:function(new_count){new_count!==this.total_blocks&&(this.total_blocks=new_count,this.renderPositionList())},onSelectChange:function(){var val=this.$select.val();0!==val&&(this.mediator.trigger("blocks:changePosition",this.$block,val,1===val?"before":"after"),this.toggle())},renderPositionList:function(){for(var inner="<option value='0'>"+i18n.t("general:position")+"</option>",i=1;i<=this.total_blocks;i++)inner+="<option value="+i+">"+i+"</option>";this.$select.html(inner)},toggle:function(){this.$select.val(0),this.$el.toggleClass(this.visibleClass)},show:function(){this.$el.addClass(this.visibleClass)},hide:function(){this.$el.removeClass(this.visibleClass)}}),module.exports=BlockPositioner},{"./function-bind":170,"./renderable":177}],140:[function(require,module){"use strict";var _=require("./lodash"),EventBus=require("./event-bus"),BlockReorder=function(block_element,mediator){this.$block=block_element,this.blockID=this.$block.attr("id"),this.mediator=mediator,this._ensureElement(),this._bindFunctions(),this.initialize()};Object.assign(BlockReorder.prototype,require("./function-bind"),require("./renderable"),{bound:["onMouseDown","onDragStart","onDragEnd","onDrop"],className:"st-block-ui-btn st-block-ui-btn--reorder st-icon",tagName:"a",attributes:function(){return{html:"reorder",draggable:"true","data-icon":"move"}},initialize:function(){this.$el.bind("mousedown touchstart",this.onMouseDown).bind("dragstart",this.onDragStart).bind("dragend touchend",this.onDragEnd),this.$block.dropArea().bind("drop",this.onDrop)},blockId:function(){return this.$block.attr("id")},onMouseDown:function(){this.mediator.trigger("block-controls:hide"),EventBus.trigger("block:reorder:down")},onDrop:function(ev){ev.preventDefault();var dropped_on=this.$block,item_id=ev.originalEvent.dataTransfer.getData("text/plain"),block=$("#"+item_id);_.isUndefined(item_id)||_.isEmpty(block)||dropped_on.attr("id")===item_id||dropped_on.attr("data-instance")!==block.attr("data-instance")||dropped_on.after(block),this.mediator.trigger("block:rerender",item_id),EventBus.trigger("block:reorder:dropped",item_id)},onDragStart:function(ev){var btn=$(ev.currentTarget).parent();ev.originalEvent.dataTransfer.setDragImage(this.$block[0],btn.position().left,btn.position().top),ev.originalEvent.dataTransfer.setData("Text",this.blockId()),EventBus.trigger("block:reorder:dragstart"),this.$block.addClass("st-block--dragging")},onDragEnd:function(){EventBus.trigger("block:reorder:dragend"),this.$block.removeClass("st-block--dragging")},render:function(){return this}}),module.exports=BlockReorder},{"./event-bus":162,"./function-bind":170,"./lodash":175,"./renderable":177}],141:[function(require,module){"use strict";var _=require("./lodash"),utils=require("./utils"),EventBus=require("./event-bus");module.exports={blockStorage:{},createStore:function(blockData){this.blockStorage={type:utils.underscored(this.type),data:blockData||{}}},save:function(){var data=this._serializeData();_.isEmpty(data)||this.setData(data)},getData:function(){return this.save(),this.blockStorage},getBlockData:function(){return this.save(),this.blockStorage.data},_getData:function(){return this.blockStorage.data},setData:function(blockData){utils.log("Setting data for block "+this.blockID),Object.assign(this.blockStorage.data,blockData||{})},setAndLoadData:function(blockData){this.setData(blockData),this.beforeLoadingData()},_serializeData:function(){},loadData:function(){},beforeLoadingData:function(){utils.log("loadData for "+this.blockID),EventBus.trigger("editor/block/loadData"),this.loadData(this._getData())},_loadData:function(){utils.log("_loadData is deprecated and will be removed in the future. Please use beforeLoadingData instead."),this.beforeLoadingData()},checkAndLoadData:function(){_.isEmpty(this._getData())||this.beforeLoadingData()}}},{"./event-bus":162,"./lodash":175,"./utils":181}],142:[function(require,module){"use strict";var _=require("./lodash"),utils=require("./utils"),bestNameFromField=function(field){var msg=field.attr("data-st-name")||field.attr("name");return msg||(msg="Field"),utils.capitalize(msg)};module.exports={errors:[],valid:function(){return this.performValidations(),0===this.errors.length},performValidations:function(){this.resetErrors();var required_fields=this.$(".st-required");required_fields.each(function(i,f){this.validateField(f)}.bind(this)),this.validations.forEach(this.runValidator,this),this.$el.toggleClass("st-block--with-errors",this.errors.length>0)},validations:[],validateField:function(field){field=$(field);var content=field.attr("contenteditable")?field.text():field.val();0===content.length&&this.setError(field,i18n.t("errors:block_empty",{name:bestNameFromField(field)}))},runValidator:function(validator){_.isUndefined(this[validator])||this[validator].call(this)},setError:function(field,reason){var $msg=this.addMessage(reason,"st-msg--error");field.addClass("st-error"),this.errors.push({field:field,reason:reason,msg:$msg})},resetErrors:function(){this.errors.forEach(function(error){error.field.removeClass("st-error"),error.msg.remove()}),this.$messages.removeClass("st-block__messages--is-visible"),this.errors=[]}}},{"./lodash":175,"./utils":181}],143:[function(require,module){"use strict";var _=require("./lodash"),Scribe=require("scribe-editor"),scribePluginFormatterPlainTextConvertNewLinesToHTML=require("scribe-plugin-formatter-plain-text-convert-new-lines-to-html"),scribePluginLinkPromptCommand=require("scribe-plugin-link-prompt-command"),config=require("./config"),utils=require("./utils"),stToMarkdown=require("./to-markdown"),BlockMixins=require("./block_mixins"),SimpleBlock=require("./simple-block"),BlockReorder=require("./block-reorder"),BlockDeletion=require("./block-deletion"),BlockPositioner=require("./block-positioner"),EventBus=require("./event-bus"),Spinner=require("spin.js"),Block=function(){SimpleBlock.apply(this,arguments)};Block.prototype=Object.create(SimpleBlock.prototype),Block.prototype.constructor=Block;var delete_template=["<div class='st-block__ui-delete-controls'>","<label class='st-block__delete-label'>","<%= i18n.t('general:delete') %>","</label>","<a class='st-block-ui-btn st-block-ui-btn--confirm-delete st-icon' data-icon='tick'></a>","<a class='st-block-ui-btn st-block-ui-btn--deny-delete st-icon' data-icon='close'></a>","</div>"].join("\n");Object.assign(Block.prototype,SimpleBlock.fn,require("./block-validations"),{bound:["_handleContentPaste","_onFocus","_onBlur","onDrop","onDeleteClick","clearInsertedStyles","getSelectionForFormatter","onBlockRender"],className:"st-block st-icon--add",attributes:function(){return Object.assign(SimpleBlock.fn.attributes.call(this),{"data-icon-after":"add"})},icon_name:"default",validationFailMsg:function(){return i18n.t("errors:validation_fail",{type:this.title()})},editorHTML:'<div class="st-block__editor"></div>',toolbarEnabled:!0,availableMixins:["droppable","pastable","uploadable","fetchable","ajaxable","controllable"],droppable:!1,pastable:!1,uploadable:!1,fetchable:!1,ajaxable:!1,drop_options:{},paste_options:{},upload_options:{},formattable:!0,_previousSelection:"",initialize:function(){},toMarkdown:function(markdown){return markdown},toHTML:function(html){return html},withMixin:function(mixin){if(_.isObject(mixin)){var initializeMethod="initialize"+mixin.mixinName;_.isUndefined(this[initializeMethod])&&(Object.assign(this,mixin),this[initializeMethod]())}},render:function(){if(this.beforeBlockRender(),this._setBlockInner(),this.$editor=this.$inner.children().first(),this.droppable||this.pastable||this.uploadable){var input_html=$("<div>",{"class":"st-block__inputs"});this.$inner.append(input_html),this.$inputs=input_html}return this.hasTextBlock&&this._initTextBlocks(),this.availableMixins.forEach(function(mixin){this[mixin]&&this.withMixin(BlockMixins[utils.classify(mixin)])},this),this.formattable&&this._initFormatting(),this._blockPrepare(),this},remove:function(){this.ajaxable&&this.resolveAllInQueue(),this.$el.remove()},loading:function(){_.isUndefined(this.spinner)||this.ready(),this.spinner=new Spinner(config.defaults.spinner),this.spinner.spin(this.$el[0]),this.$el.addClass("st--is-loading")},ready:function(){this.$el.removeClass("st--is-loading"),_.isUndefined(this.spinner)||(this.spinner.stop(),delete this.spinner)},_serializeData:function(){utils.log("toData for "+this.blockID);var data={};return this.hasTextBlock()&&(data.text=this.getTextBlockHTML(),data.text.length>0&&this.options.convertToMarkdown&&(data.text=stToMarkdown(data.text,this.type))),this.$(":input").not(".st-paste-block").length>0&&this.$(":input").each(function(index,input){input.getAttribute("name")&&(data[input.getAttribute("name")]=input.value)}),data},focus:function(){this.getTextBlock().focus()},blur:function(){this.getTextBlock().blur()},onFocus:function(){this.getTextBlock().bind("focus",this._onFocus)},onBlur:function(){this.getTextBlock().bind("blur",this._onBlur)},_onFocus:function(){this.trigger("blockFocus",this.$el)},_onBlur:function(){},onBlockRender:function(){this.focus()},onDrop:function(){},onDeleteClick:function(ev){ev.preventDefault();var onDeleteConfirm=function(e){e.preventDefault(),this.mediator.trigger("block:remove",this.blockID),this.remove()},onDeleteDeny=function(e){e.preventDefault(),this.$el.removeClass("st-block--delete-active"),$delete_el.remove()};if(this.isEmpty())return void onDeleteConfirm.call(this,new Event("click"));this.$inner.append(_.template(delete_template)),this.$el.addClass("st-block--delete-active");var $delete_el=this.$inner.find(".st-block__ui-delete-controls");this.$inner.on("click",".st-block-ui-btn--confirm-delete",onDeleteConfirm.bind(this)).on("click",".st-block-ui-btn--deny-delete",onDeleteDeny.bind(this))},beforeLoadingData:function(){this.loading(),(this.droppable||this.uploadable||this.pastable)&&(this.$editor.show(),this.$inputs.hide()),SimpleBlock.fn.beforeLoadingData.call(this),this.ready()},execTextBlockCommand:function(cmdName){if(_.isUndefined(this._scribe))throw"No Scribe instance found to send a command to";var cmd=this._scribe.getCommand(cmdName);this._scribe.el.focus(),cmd.execute()},queryTextBlockCommandState:function(cmdName){if(_.isUndefined(this._scribe))throw"No Scribe instance found to query command";var cmd=this._scribe.getCommand(cmdName),sel=new this._scribe.api.Selection;return sel.range&&cmd.queryState()},_handleContentPaste:function(ev){setTimeout(this.onContentPasted.bind(this,ev,$(ev.currentTarget)),0)},_getBlockClass:function(){return"st-block--"+this.className},_initUIComponents:function(){var positioner=new BlockPositioner(this.$el,this.mediator);this._withUIComponent(positioner,".st-block-ui-btn--reorder",positioner.toggle),this._withUIComponent(new BlockReorder(this.$el,this.mediator)),this._withUIComponent(new BlockDeletion,".st-block-ui-btn--delete",this.onDeleteClick),this.onFocus(),this.onBlur()},_initFormatting:function(){var block=this;this.options.formatBar&&this.options.formatBar.commands.forEach(function(cmd){if(!_.isUndefined(cmd.keyCode)){var ctrlDown=!1;block.$el.on("keyup",".st-text-block",function(ev){(17===ev.which||224===ev.which||91===ev.which)&&(ctrlDown=!1)}).on("keydown",".st-text-block",{formatter:cmd},function(ev){(17===ev.which||224===ev.which||91===ev.which)&&(ctrlDown=!0),ev.which===ev.data.formatter.keyCode&&ctrlDown&&(ev.preventDefault(),block.execTextBlockCommand(ev.data.formatter.cmd))})}})},_initTextBlocks:function(){this.getTextBlock().bind("keyup",this.getSelectionForFormatter).bind("mouseup",this.getSelectionForFormatter).bind("DOMNodeInserted",this.clearInsertedStyles);var textBlock=this.getTextBlock().get(0);!_.isUndefined(textBlock)&&_.isUndefined(this._scribe)&&(this._scribe=new Scribe(textBlock,{debug:config.scribeDebug}),this._scribe.use(scribePluginFormatterPlainTextConvertNewLinesToHTML()),this._scribe.use(scribePluginLinkPromptCommand()),_.isFunction(this.options.configureScribe)&&this.options.configureScribe.call(this,this._scribe))},getSelectionForFormatter:function(){var block=this;setTimeout(function(){var selection=window.getSelection(),selectionStr=selection.toString().trim(),en="formatter:"+(""===selectionStr?"hide":"position");block.mediator.trigger(en,block),EventBus.trigger(en,block)},1)},clearInsertedStyles:function(e){var target=e.target;target.removeAttribute("style")},hasTextBlock:function(){return this.getTextBlock().length>0},getTextBlock:function(){return _.isUndefined(this.text_block)&&(this.text_block=this.$(".st-text-block")),this.text_block},getTextBlockHTML:function(){return this._scribe.getHTML()},setTextBlockHTML:function(html){return this._scribe.setContent(html)},isEmpty:function(){return _.isEmpty(this.getBlockData())}}),Block.extend=require("./helpers/extend"),module.exports=Block},{"./block-deletion":137,"./block-positioner":139,"./block-reorder":140,"./block-validations":142,"./block_mixins":148,"./config":159,"./event-bus":162,"./helpers/extend":172,"./lodash":175,"./simple-block":178,"./to-markdown":180,"./utils":181,"scribe-editor":129,"scribe-plugin-formatter-plain-text-convert-new-lines-to-html":132,"scribe-plugin-link-prompt-command":133,"spin.js":134}],144:[function(require,module){"use strict";var utils=require("../utils");module.exports={mixinName:"Ajaxable",ajaxable:!0,initializeAjaxable:function(){this._queued=[]},addQueuedItem:function(name,deferred){utils.log("Adding queued item for "+this.blockID+" called "+name),this._queued.push({name:name,deferred:deferred})},removeQueuedItem:function(name){utils.log("Removing queued item for "+this.blockID+" called "+name),this._queued=this._queued.filter(function(queued){return queued.name!==name})},hasItemsInQueue:function(){return this._queued.length>0},resolveAllInQueue:function(){this._queued.forEach(function(item){utils.log("Aborting queued request: "+item.name),item.deferred.abort()},this)}}},{"../utils":181}],145:[function(require,module){"use strict";var utils=require("../utils");module.exports={mixinName:"Controllable",initializeControllable:function(){utils.log("Adding controllable to block "+this.blockID),this.$control_ui=$("<div>",{"class":"st-block__control-ui"}),Object.keys(this.controls).forEach(function(cmd){this.addUiControl(cmd,this.controls[cmd].bind(this))},this),this.$inner.append(this.$control_ui)},getControlTemplate:function(cmd){return $("<a>",{"data-icon":cmd,"class":"st-icon st-block-control-ui-btn st-block-control-ui-btn--"+cmd})},addUiControl:function(cmd,handler){this.$control_ui.append(this.getControlTemplate(cmd)),this.$control_ui.on("click",".st-block-control-ui-btn--"+cmd,handler)}}},{"../utils":181}],146:[function(require,module){"use strict";var _=require("../lodash"),config=require("../config"),utils=require("../utils"),EventBus=require("../event-bus");module.exports={mixinName:"Droppable",valid_drop_file_types:["File","Files","text/plain","text/uri-list"],initializeDroppable:function(){utils.log("Adding droppable to block "+this.blockID),this.drop_options=Object.assign({},config.defaults.Block.drop_options,this.drop_options);var drop_html=$(_.template(this.drop_options.html,{block:this,_:_}));this.$editor.hide(),this.$inputs.append(drop_html),this.$dropzone=drop_html,this.$dropzone.dropArea().bind("drop",this._handleDrop.bind(this)),this.$inner.addClass("st-block__inner--droppable")},_handleDrop:function(e){e.preventDefault(),e=e.originalEvent;var el=$(e.target),types=e.dataTransfer.types;el.removeClass("st-dropzone--dragover"),types&&types.some(function(type){return this.valid_drop_file_types.includes(type)},this)&&this.onDrop(e.dataTransfer),EventBus.trigger("block:content:dropped",this.blockID)}}},{"../config":159,"../event-bus":162,"../lodash":175,"../utils":181}],147:[function(require,module){"use strict";var _=require("../lodash");module.exports={mixinName:"Fetchable",initializeFetchable:function(){this.withMixin(require("./ajaxable"))},fetch:function(options,success,failure){var uid=_.uniqueId(this.blockID+"_fetch"),xhr=$.ajax(options);return this.resetMessages(),this.addQueuedItem(uid,xhr),_.isUndefined(success)||xhr.done(success.bind(this)),_.isUndefined(failure)||xhr.fail(failure.bind(this)),xhr.always(this.removeQueuedItem.bind(this,uid)),xhr}}},{"../lodash":175,"./ajaxable":144}],148:[function(require,module){"use strict";module.exports={Ajaxable:require("./ajaxable.js"),Controllable:require("./controllable.js"),Droppable:require("./droppable.js"),Fetchable:require("./fetchable.js"),Pastable:require("./pastable.js"),Uploadable:require("./uploadable.js")}},{"./ajaxable.js":144,"./controllable.js":145,"./droppable.js":146,"./fetchable.js":147,"./pastable.js":149,"./uploadable.js":150}],149:[function(require,module){"use strict";var _=require("../lodash"),config=require("../config"),utils=require("../utils");module.exports={mixinName:"Pastable",initializePastable:function(){utils.log("Adding pastable to block "+this.blockID),this.paste_options=Object.assign({},config.defaults.Block.paste_options,this.paste_options),this.$inputs.append(_.template(this.paste_options.html,this)),this.$(".st-paste-block").bind("click",function(){$(this).select()}).bind("paste",this._handleContentPaste).bind("submit",this._handleContentPaste)}}},{"../config":159,"../lodash":175,"../utils":181}],150:[function(require,module){"use strict";var _=require("../lodash"),config=require("../config"),utils=require("../utils"),fileUploader=require("../extensions/file-uploader");module.exports={mixinName:"Uploadable",uploadsCount:0,initializeUploadable:function(){utils.log("Adding uploadable to block "+this.blockID),this.withMixin(require("./ajaxable")),this.upload_options=Object.assign({},config.defaults.Block.upload_options,this.upload_options),this.$inputs.append(_.template(this.upload_options.html,this))},uploader:function(file,success,failure){return fileUploader(this,file,success,failure)}}},{"../config":159,"../extensions/file-uploader":165,"../lodash":175,"../utils":181,"./ajaxable":144}],151:[function(require,module){"use strict";var Block=require("../block"),stToHTML=require("../to-html");module.exports=Block.extend({type:"Heading",title:function(){return i18n.t("blocks:heading:title")},editorHTML:'<div class="st-required st-text-block st-text-block--heading" contenteditable="true"></div>',icon_name:"heading",loadData:function(data){this.getTextBlock().html(stToHTML(data.text,this.type))}})},{"../block":143,"../to-html":179}],152:[function(require,module){"use strict";var Block=require("../block");module.exports=Block.extend({type:"image",title:function(){return i18n.t("blocks:image:title")},droppable:!0,uploadable:!0,icon_name:"image",loadData:function(data){this.$editor.html($("<img>",{src:data.file.url}))},onBlockRender:function(){this.$inputs.find("button").bind("click",function(ev){ev.preventDefault()}),this.$inputs.find("input").on("change",function(ev){this.onDrop(ev.currentTarget)}.bind(this))},onDrop:function(transferData){var file=transferData.files[0],urlAPI="undefined"!=typeof URL?URL:"undefined"!=typeof webkitURL?webkitURL:null;/image/.test(file.type)&&(this.loading(),this.$inputs.hide(),this.$editor.html($("<img>",{src:urlAPI.createObjectURL(file)})).show(),this.uploader(file,function(data){this.setData(data),this.ready()},function(){this.addMessage(i18n.t("blocks:image:upload_error")),this.ready()}))}})},{"../block":143}],153:[function(require,module){"use strict";module.exports={Text:require("./text"),Quote:require("./quote"),Image:require("./image"),Heading:require("./heading"),List:require("./list"),Tweet:require("./tweet"),Video:require("./video")}},{"./heading":151,"./image":152,"./list":154,"./quote":155,"./text":156,"./tweet":157,"./video":158}],154:[function(require,module){"use strict";var _=require("../lodash"),Block=require("../block"),stToHTML=require("../to-html"),template='<div class="st-text-block st-required" contenteditable="true"><ul><li></li></ul></div>';module.exports=Block.extend({type:"list",title:function(){return i18n.t("blocks:list:title")},icon_name:"list",editorHTML:function(){return _.template(template,this)},loadData:function(data){this.setTextBlockHTML("<ul>"+stToHTML(data.text,this.type)+"</ul>")},onBlockRender:function(){this.checkForList=this.checkForList.bind(this),this.getTextBlock().on("click keyup",this.checkForList),this.focus()},checkForList:function(){0===this.$("ul").length&&document.execCommand("insertUnorderedList",!1,!1)},toMarkdown:function(markdown){return markdown.replace(/<\/li>/gm,"\n").replace(/<\/?[^>]+(>|$)/g,"").replace(/^(.+)$/gm," - $1")},toHTML:function(html){return html=html.replace(/^ - (.+)$/gm,"<li>$1</li>").replace(/\n/gm,"")},onContentPasted:function(event,target){this.$("ul").html(this.pastedMarkdownToHTML(target[0].innerHTML)),this.getTextBlock().caretToEnd()},isEmpty:function(){return _.isEmpty(this.getBlockData().text)}})},{"../block":143,"../lodash":175,"../to-html":179}],155:[function(require,module){"use strict";var _=require("../lodash"),Block=require("../block"),stToHTML=require("../to-html"),template=_.template(['<blockquote class="st-required st-text-block" contenteditable="true"></blockquote>','<label class="st-input-label"> <%= i18n.t("blocks:quote:credit_field") %></label>','<input maxlength="140" name="cite" placeholder="<%= i18n.t("blocks:quote:credit_field") %>"',' class="st-input-string st-required js-cite-input" type="text" />'].join("\n"));module.exports=Block.extend({type:"quote",title:function(){return i18n.t("blocks:quote:title")},icon_name:"quote",editorHTML:function(){return template(this)},loadData:function(data){this.getTextBlock().html(stToHTML(data.text,this.type)),this.$(".js-cite-input").val(data.cite)},toMarkdown:function(markdown){return markdown.replace(/^(.+)$/gm,"> $1")}})},{"../block":143,"../lodash":175,"../to-html":179}],156:[function(require,module){"use strict";var Block=require("../block"),stToHTML=require("../to-html");module.exports=Block.extend({type:"text",title:function(){return i18n.t("blocks:text:title")},editorHTML:'<div class="st-required st-text-block" contenteditable="true"></div>',icon_name:"text",loadData:function(data){this.getTextBlock().html(stToHTML(data.text,this.type))}})},{"../block":143,"../to-html":179}],157:[function(require,module){"use strict";var _=require("../lodash"),utils=require("../utils"),Block=require("../block"),tweet_template=_.template(["<blockquote class='twitter-tweet' align='center'>","<p><%= text %></p>","&mdash; <%= user.name %> (@<%= user.screen_name %>)","<a href='<%= status_url %>' data-datetime='<%= created_at %>'><%= created_at %></a>","</blockquote>",'<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>'].join("\n"));
module.exports=Block.extend({type:"tweet",droppable:!0,pastable:!0,fetchable:!0,drop_options:{re_render_on_reorder:!0},title:function(){return i18n.t("blocks:tweet:title")},fetchUrl:function(tweetID){return"/tweets/?tweet_id="+tweetID},icon_name:"twitter",loadData:function(data){_.isUndefined(data.status_url)&&(data.status_url=""),this.$inner.find("iframe").remove(),this.$inner.prepend(tweet_template(data))},onContentPasted:function(event){var input=$(event.target),val=input.val();this.handleTwitterDropPaste(val)},handleTwitterDropPaste:function(url){if(!this.validTweetUrl(url))return void utils.log("Invalid Tweet URL");var tweetID=url.match(/[^\/]+$/);if(!_.isEmpty(tweetID)){this.loading(),tweetID=tweetID[0];var ajaxOptions={url:this.fetchUrl(tweetID),dataType:"json"};this.fetch(ajaxOptions,this.onTweetSuccess,this.onTweetFail)}},validTweetUrl:function(url){return utils.isURI(url)&&-1!==url.indexOf("twitter")&&-1!==url.indexOf("status")},onTweetSuccess:function(data){var obj={user:{profile_image_url:data.user.profile_image_url,profile_image_url_https:data.user.profile_image_url_https,screen_name:data.user.screen_name,name:data.user.name},id:data.id_str,text:data.text,created_at:data.created_at,entities:data.entities,status_url:"https://twitter.com/"+data.user.screen_name+"/status/"+data.id_str};this.setAndLoadData(obj),this.ready()},onTweetFail:function(){this.addMessage(i18n.t("blocks:tweet:fetch_error")),this.ready()},onDrop:function(transferData){var url=transferData.getData("text/plain");this.handleTwitterDropPaste(url)}})},{"../block":143,"../lodash":175,"../utils":181}],158:[function(require,module){"use strict";var _=require("../lodash"),utils=require("../utils"),Block=require("../block");module.exports=Block.extend({providers:{vimeo:{regex:/(?:http[s]?:\/\/)?(?:www.)?vimeo.com\/(.+)/,html:'<iframe src="{{protocol}}//player.vimeo.com/video/{{remote_id}}?title=0&byline=0" width="580" height="320" frameborder="0"></iframe>'},youtube:{regex:/(?:http[s]?:\/\/)?(?:www.)?(?:(?:youtube.com\/watch\?(?:.*)(?:v=))|(?:youtu.be\/))([^&].+)/,html:'<iframe src="{{protocol}}//www.youtube.com/embed/{{remote_id}}" width="580" height="320" frameborder="0" allowfullscreen></iframe>'}},type:"video",title:function(){return i18n.t("blocks:video:title")},droppable:!0,pastable:!0,icon_name:"video",loadData:function(data){if(this.providers.hasOwnProperty(data.source)){this.$editor.addClass(this.providers[data.source].square?"st-block__editor--with-square-media":"st-block__editor--with-sixteen-by-nine-media");var embed_string=this.providers[data.source].html.replace("{{protocol}}",window.location.protocol).replace("{{remote_id}}",data.remote_id).replace("{{width}}",this.$editor.width());this.$editor.html(embed_string)}},onContentPasted:function(event){this.handleDropPaste($(event.target).val())},handleDropPaste:function(url){if(utils.isURI(url)){var match,data;this.providers.forEach(function(provider,index){match=provider.regex.exec(url),null===match||_.isUndefined(match[1])||(data={source:index,remote_id:match[1]},this.setAndLoadData(data))},this)}},onDrop:function(transferData){var url=transferData.getData("text/plain");this.handleDropPaste(url)}})},{"../block":143,"../lodash":175,"../utils":181}],159:[function(require,module){"use strict";var drop_options={html:['<div class="st-block__dropzone">','<span class="st-icon"><%= _.result(block, "icon_name") %></span>','<p><%= i18n.t("general:drop", { block: "<span>" + _.result(block, "title") + "</span>" }) %>',"</p></div>"].join("\n"),re_render_on_reorder:!1},paste_options={html:['<input type="text" placeholder="<%= i18n.t("general:paste") %>"',' class="st-block__paste-input st-paste-block">'].join("")},upload_options={html:['<div class="st-block__upload-container">','<input type="file" type="st-file-upload">','<button class="st-upload-btn"><%= i18n.t("general:upload") %></button>',"</div>"].join("\n")};module.exports={debug:!1,scribeDebug:!1,skipValidation:!1,version:"0.4.0",language:"en",instances:[],defaults:{defaultType:!1,spinner:{className:"st-spinner",lines:9,length:8,width:3,radius:6,color:"#000",speed:1.4,trail:57,shadow:!1,left:"50%",top:"50%"},Block:{drop_options:drop_options,paste_options:paste_options,upload_options:upload_options},blockLimit:0,blockTypeLimits:{},required:[],uploadUrl:"/attachments",baseImageUrl:"/sir-trevor-uploads/",errorsContainer:void 0,convertToMarkdown:!1,convertFromMarkdown:!0,formatBar:{commands:[{name:"Bold",title:"bold",cmd:"bold",keyCode:66,text:"B"},{name:"Italic",title:"italic",cmd:"italic",keyCode:73,text:"i"},{name:"Link",title:"link",iconName:"link",cmd:"linkPrompt",text:"link"},{name:"Unlink",title:"unlink",iconName:"link",cmd:"unlink",text:"link"}]}}}},{}],160:[function(require,module){"use strict";var _=require("./lodash"),config=require("./config"),utils=require("./utils"),Events=require("./events"),EventBus=require("./event-bus"),FormEvents=require("./form-events"),BlockControls=require("./block-controls"),BlockManager=require("./block-manager"),FloatingBlockControls=require("./floating-block-controls"),FormatBar=require("./format-bar"),EditorStore=require("./extensions/editor-store"),ErrorHandler=require("./error-handler"),Editor=function(options){this.initialize(options)};Object.assign(Editor.prototype,require("./function-bind"),require("./events"),{bound:["onFormSubmit","hideAllTheThings","changeBlockPosition","removeBlockDragOver","renderBlock","resetBlockControls","blockLimitReached"],events:{"block:reorder:dragend":"removeBlockDragOver","block:content:dropped":"removeBlockDragOver"},initialize:function(options){return utils.log("Init SirTrevor.Editor"),this.options=Object.assign({},config.defaults,options||{}),this.ID=_.uniqueId("st-editor-"),this._ensureAndSetElements()?(!_.isUndefined(this.options.onEditorRender)&&_.isFunction(this.options.onEditorRender)&&(this.onEditorRender=this.options.onEditorRender),this.mediator=Object.assign({},Events),this._bindFunctions(),config.instances.push(this),this.build(),void FormEvents.bindFormSubmit(this.$form)):!1},build:function(){this.$el.hide(),this.errorHandler=new ErrorHandler(this.$outer,this.mediator,this.options.errorsContainer),this.store=new EditorStore(this.$el.val(),this.mediator),this.block_manager=new BlockManager(this.options,this.ID,this.mediator),this.block_controls=new BlockControls(this.block_manager.blockTypes,this.mediator),this.fl_block_controls=new FloatingBlockControls(this.$wrapper,this.ID,this.mediator),this.formatBar=new FormatBar(this.options.formatBar,this.mediator),this.mediator.on("block:changePosition",this.changeBlockPosition),this.mediator.on("block-controls:reset",this.resetBlockControls),this.mediator.on("block:limitReached",this.blockLimitReached),this.mediator.on("block:render",this.renderBlock),this.dataStore="Please use store.retrieve();",this._setEvents(),this.$wrapper.prepend(this.fl_block_controls.render().$el),$(document.body).append(this.formatBar.render().$el),this.$outer.append(this.block_controls.render().$el),$(window).bind("click",this.hideAllTheThings),this.createBlocks(),this.$wrapper.addClass("st-ready"),_.isUndefined(this.onEditorRender)||this.onEditorRender()},createBlocks:function(){var store=this.store.retrieve();store.data.length>0?store.data.forEach(function(block){this.mediator.trigger("block:create",block.type,block.data)},this):this.options.defaultType!==!1&&this.mediator.trigger("block:create",this.options.defaultType,{})},destroy:function(){this.formatBar.destroy(),this.fl_block_controls.destroy(),this.block_controls.destroy(),this.blocks.forEach(function(){this.mediator.trigger("block:remove",this.block.blockID)},this),this.mediator.stopListening(),this.stopListening(),config.instances=config.instances.filter(function(instance){return instance.ID!==this.ID},this),this.store.reset(),this.$outer.replaceWith(this.$el.detach())},reinitialize:function(options){this.destroy(),this.initialize(options||this.options)},resetBlockControls:function(){this.block_controls.renderInContainer(this.$wrapper),this.block_controls.hide()},blockLimitReached:function(toggle){this.$wrapper.toggleClass("st--block-limit-reached",toggle)},_setEvents:function(){Object.keys(this.events).forEach(function(type){EventBus.on(type,this[this.events[type]],this)},this)},hideAllTheThings:function(){this.block_controls.hide(),this.formatBar.hide()},store:function(method,options){return utils.log("The store method has been removed, please call store[methodName]"),this.store[method].call(this,options||{})},renderBlock:function(block){this._renderInPosition(block.render().$el),this.hideAllTheThings(),this.scrollTo(block.$el),block.trigger("onRender")},scrollTo:function(element){$("html, body").animate({scrollTop:element.position().top},300,"linear")},removeBlockDragOver:function(){this.$outer.find(".st-drag-over").removeClass("st-drag-over")},changeBlockPosition:function($block,selectedPosition){selectedPosition-=1;var blockPosition=this.getBlockPosition($block),$blockBy=this.$wrapper.find(".st-block").eq(selectedPosition),where=blockPosition>selectedPosition?"Before":"After";$blockBy&&$blockBy.attr("id")!==$block.attr("id")&&(this.hideAllTheThings(),$block["insert"+where]($blockBy),this.scrollTo($block))},_renderInPosition:function(block){this.block_controls.currentContainer?this.block_controls.currentContainer.after(block):this.$wrapper.append(block)},validateAndSaveBlock:function(block,shouldValidate){if((!config.skipValidation||shouldValidate)&&!block.valid())return this.mediator.trigger("errors:add",{text:_.result(block,"validationFailMsg")}),void utils.log("Block "+block.blockID+" failed validation");var blockData=block.getData();utils.log("Adding data for block "+block.blockID+" to block store:",blockData),this.store.addData(blockData)},onFormSubmit:function(shouldValidate){return shouldValidate=shouldValidate===!1?!1:!0,utils.log("Handling form submission for Editor "+this.ID),this.mediator.trigger("errors:reset"),this.store.reset(),this.validateBlocks(shouldValidate),this.block_manager.validateBlockTypesExist(shouldValidate),this.mediator.trigger("errors:render"),this.$el.val(this.store.toString()),this.errorHandler.errors.length},validateBlocks:function(shouldValidate){var self=this;this.$wrapper.find(".st-block").each(function(idx,block){var _block=self.block_manager.findBlockById($(block).attr("id"));_.isUndefined(_block)||self.validateAndSaveBlock(_block,shouldValidate)})},findBlockById:function(block_id){return this.block_manager.findBlockById(block_id)},getBlocksByType:function(block_type){return this.block_manager.getBlocksByType(block_type)},getBlocksByIDs:function(block_ids){return this.block_manager.getBlocksByIDs(block_ids)},getBlockPosition:function($block){return this.$wrapper.find(".st-block").index($block)},_ensureAndSetElements:function(){if(_.isUndefined(this.options.el)||_.isEmpty(this.options.el))return utils.log("You must provide an el"),!1;this.$el=this.options.el,this.el=this.options.el[0],this.$form=this.$el.parents("form");var $outer=$("<div>").attr({id:this.ID,"class":"st-outer",dropzone:"copy link move"}),$wrapper=$("<div>").attr({"class":"st-blocks"});return this.$el.wrap($outer).wrap($wrapper),this.$outer=this.$form.find("#"+this.ID),this.$wrapper=this.$outer.find(".st-blocks"),!0}}),module.exports=Editor},{"./block-controls":136,"./block-manager":138,"./config":159,"./error-handler":161,"./event-bus":162,"./events":163,"./extensions/editor-store":164,"./floating-block-controls":167,"./form-events":168,"./format-bar":169,"./function-bind":170,"./lodash":175,"./utils":181}],161:[function(require,module){"use strict";var _=require("./lodash"),ErrorHandler=function($wrapper,mediator,container){this.$wrapper=$wrapper,this.mediator=mediator,this.$el=container,_.isUndefined(this.$el)&&(this._ensureElement(),this.$wrapper.prepend(this.$el)),this.$el.hide(),this._bindFunctions(),this._bindMediatedEvents(),this.initialize()};Object.assign(ErrorHandler.prototype,require("./function-bind"),require("./mediated-events"),require("./renderable"),{errors:[],className:"st-errors",eventNamespace:"errors",mediatedEvents:{reset:"reset",add:"addMessage",render:"render"},initialize:function(){var $list=$("<ul>");this.$el.append("<p>"+i18n.t("errors:title")+"</p>").append($list),this.$list=$list},render:function(){return 0===this.errors.length?!1:(this.errors.forEach(this.createErrorItem,this),void this.$el.show())},createErrorItem:function(error){var $error=$("<li>",{"class":"st-errors__msg",html:error.text});this.$list.append($error)},addMessage:function(error){this.errors.push(error)},reset:function(){return 0===this.errors.length?!1:(this.errors=[],this.$list.html(""),void this.$el.hide())}}),module.exports=ErrorHandler},{"./function-bind":170,"./lodash":175,"./mediated-events":176,"./renderable":177}],162:[function(require,module){"use strict";module.exports=Object.assign({},require("./events"))},{"./events":163}],163:[function(require,module){"use strict";module.exports=require("eventablejs")},{eventablejs:3}],164:[function(require,module){"use strict";var _=require("../lodash"),utils=require("../utils"),EditorStore=function(data,mediator){this.mediator=mediator,this.initialize(data?data.trim():"")};Object.assign(EditorStore.prototype,{initialize:function(data){this.store=this._parseData(data)||{data:[]}},retrieve:function(){return this.store},toString:function(space){return JSON.stringify(this.store,void 0,space)},reset:function(){utils.log("Resetting the EditorStore"),this.store={data:[]}},addData:function(data){return this.store.data.push(data),this.store},_parseData:function(data){var result;if(0===data.length)return result;try{var jsonStr=JSON.parse(data);_.isUndefined(jsonStr.data)||(result=jsonStr)}catch(e){this.mediator.trigger("errors:add",{text:i18n.t("errors:load_fail")}),this.mediator.trigger("errors:render"),console.log("Sorry there has been a problem with parsing the JSON"),console.log(e)}return result}}),module.exports=EditorStore},{"../lodash":175,"../utils":181}],165:[function(require,module){"use strict";var _=require("../lodash"),config=require("../config"),utils=require("../utils"),EventBus=require("../event-bus");module.exports=function(block,file,success,error){EventBus.trigger("onUploadStart");var uid=[block.blockID,(new Date).getTime(),"raw"].join("-"),data=new FormData;data.append("attachment[name]",file.name),data.append("attachment[file]",file),data.append("attachment[uid]",uid),block.resetMessages();var callbackSuccess=function(){utils.log("Upload callback called"),EventBus.trigger("onUploadStop"),!_.isUndefined(success)&&_.isFunction(success)&&success.apply(block,arguments)},callbackError=function(jqXHR,status){utils.log("Upload callback error called"),EventBus.trigger("onUploadStop"),!_.isUndefined(error)&&_.isFunction(error)&&error.call(block,status)},xhr=$.ajax({url:config.defaults.uploadUrl,data:data,cache:!1,contentType:!1,processData:!1,dataType:"json",type:"POST"});return block.addQueuedItem(uid,xhr),xhr.done(callbackSuccess).fail(callbackError).always(block.removeQueuedItem.bind(block,uid)),xhr}},{"../config":159,"../event-bus":162,"../lodash":175,"../utils":181}],166:[function(require,module){"use strict";var utils=require("../utils"),EventBus=require("../event-bus"),Submittable=function($form){this.$form=$form,this.intialize()};Object.assign(Submittable.prototype,{intialize:function(){this.submitBtn=this.$form.find("input[type='submit']");var btnTitles=[];this.submitBtn.each(function(i,btn){btnTitles.push($(btn).attr("value"))}),this.submitBtnTitles=btnTitles,this.canSubmit=!0,this.globalUploadCount=0,this._bindEvents()},setSubmitButton:function(e,message){this.submitBtn.attr("value",message)},resetSubmitButton:function(){var titles=this.submitBtnTitles;this.submitBtn.each(function(index,item){$(item).attr("value",titles[index])})},onUploadStart:function(){this.globalUploadCount++,utils.log("onUploadStart called "+this.globalUploadCount),1===this.globalUploadCount&&this._disableSubmitButton()},onUploadStop:function(){this.globalUploadCount=this.globalUploadCount<=0?0:this.globalUploadCount-1,utils.log("onUploadStop called "+this.globalUploadCount),0===this.globalUploadCount&&this._enableSubmitButton()},onError:function(){utils.log("onError called"),this.canSubmit=!1},_disableSubmitButton:function(message){this.setSubmitButton(null,message||i18n.t("general:wait")),this.submitBtn.attr("disabled","disabled").addClass("disabled")},_enableSubmitButton:function(){this.resetSubmitButton(),this.submitBtn.removeAttr("disabled").removeClass("disabled")},_events:{disableSubmitButton:"_disableSubmitButton",enableSubmitButton:"_enableSubmitButton",setSubmitButton:"setSubmitButton",resetSubmitButton:"resetSubmitButton",onError:"onError",onUploadStart:"onUploadStart",onUploadStop:"onUploadStop"},_bindEvents:function(){Object.keys(this._events).forEach(function(type){EventBus.on(type,this[this._events[type]],this)},this)}}),module.exports=Submittable},{"../event-bus":162,"../utils":181}],167:[function(require,module){"use strict";var _=require("./lodash"),EventBus=require("./event-bus"),FloatingBlockControls=function(wrapper,instance_id,mediator){this.$wrapper=wrapper,this.instance_id=instance_id,this.mediator=mediator,this._ensureElement(),this._bindFunctions(),this.initialize()};Object.assign(FloatingBlockControls.prototype,require("./function-bind"),require("./renderable"),require("./events"),{className:"st-block-controls__top",attributes:function(){return{"data-icon":"add"}},bound:["handleBlockMouseOut","handleBlockMouseOver","handleBlockClick","onDrop"],initialize:function(){this.$el.on("click",this.handleBlockClick).dropArea().bind("drop",this.onDrop),this.$wrapper.on("mouseover",".st-block",this.handleBlockMouseOver).on("mouseout",".st-block",this.handleBlockMouseOut).on("click",".st-block--with-plus",this.handleBlockClick)},onDrop:function(ev){ev.preventDefault();var dropped_on=this.$el,item_id=ev.originalEvent.dataTransfer.getData("text/plain"),block=$("#"+item_id);_.isUndefined(item_id)||_.isEmpty(block)||dropped_on.attr("id")===item_id||this.instance_id!==block.attr("data-instance")||dropped_on.after(block),EventBus.trigger("block:reorder:dropped",item_id)},handleBlockMouseOver:function(e){var block=$(e.currentTarget);block.hasClass("st-block--with-plus")||block.addClass("st-block--with-plus")},handleBlockMouseOut:function(e){var block=$(e.currentTarget);block.hasClass("st-block--with-plus")&&block.removeClass("st-block--with-plus")},handleBlockClick:function(e){e.stopPropagation(),this.mediator.trigger("block-controls:render",$(e.currentTarget))}}),module.exports=FloatingBlockControls},{"./event-bus":162,"./events":163,"./function-bind":170,"./lodash":175,"./renderable":177}],168:[function(require,module){"use strict";var config=require("./config"),utils=require("./utils"),EventBus=require("./event-bus"),Submittable=require("./extensions/submittable"),formBound=!1,FormEvents={bindFormSubmit:function(form){formBound||(new Submittable(form),form.bind("submit",this.onFormSubmit),formBound=!0)},onBeforeSubmit:function(shouldValidate){var errors=0;return config.instances.forEach(function(inst){errors+=inst.onFormSubmit(shouldValidate)}),utils.log("Total errors: "+errors),errors},onFormSubmit:function(ev){var errors=FormEvents.onBeforeSubmit();errors>0&&(EventBus.trigger("onError"),ev.preventDefault())}};module.exports=FormEvents},{"./config":159,"./event-bus":162,"./extensions/submittable":166,"./utils":181}],169:[function(require,module){"use strict";var _=require("./lodash"),config=require("./config"),utils=require("./utils"),FormatBar=function(options,mediator){this.options=Object.assign({},config.defaults.formatBar,options||{}),this.commands=this.options.commands,this.mediator=mediator,this._ensureElement(),this._bindFunctions(),this._bindMediatedEvents(),this.initialize.apply(this,arguments)};Object.assign(FormatBar.prototype,require("./function-bind"),require("./mediated-events"),require("./events"),require("./renderable"),{className:"st-format-bar",bound:["onFormatButtonClick","renderBySelection","hide"],eventNamespace:"formatter",mediatedEvents:{position:"renderBySelection",show:"show",hide:"hide"},initialize:function(){this.$btns=[],this.commands.forEach(function(format){var btn=$("<button>",{"class":"st-format-btn st-format-btn--"+format.name+" "+(format.iconName?"st-icon":""),text:format.text,"data-cmd":format.cmd});this.$btns.push(btn),btn.appendTo(this.$el)},this),this.$b=$(document),this.$el.bind("click",".st-format-btn",this.onFormatButtonClick)},hide:function(){this.$el.removeClass("st-format-bar--is-ready")},show:function(){this.$el.addClass("st-format-bar--is-ready")},remove:function(){this.$el.remove()},renderBySelection:function(){var selection=window.getSelection(),range=selection.getRangeAt(0),boundary=range.getBoundingClientRect(),coords={};coords.top=boundary.top+20+window.pageYOffset-this.$el.height()+"px",coords.left=(boundary.left+boundary.right)/2-this.$el.width()/2+"px",this.highlightSelectedButtons(),this.show(),this.$el.css(coords)},highlightSelectedButtons:function(){var block=utils.getBlockBySelection();this.$btns.forEach(function(btn){var cmd=$(btn).data("cmd");btn.toggleClass("st-format-btn--is-active",block.queryTextBlockCommandState(cmd))},this)},onFormatButtonClick:function(ev){ev.stopPropagation();var block=utils.getBlockBySelection();if(_.isUndefined(block))throw"Associated block not found";var btn=$(ev.target),cmd=btn.data("cmd");return _.isUndefined(cmd)?!1:(block.execTextBlockCommand(cmd),this.highlightSelectedButtons(),!1)}}),module.exports=FormatBar},{"./config":159,"./events":163,"./function-bind":170,"./lodash":175,"./mediated-events":176,"./renderable":177,"./utils":181}],170:[function(require,module){"use strict";module.exports={bound:[],_bindFunctions:function(){this.bound.forEach(function(f){this[f]=this[f].bind(this)},this)}}},{}],171:[function(){"use strict";function dragEnter(e){e.preventDefault()}function dragOver(e){e.originalEvent.dataTransfer.dropEffect="copy",$(e.currentTarget).addClass("st-drag-over"),e.preventDefault()}function dragLeave(e){$(e.currentTarget).removeClass("st-drag-over"),e.preventDefault()}$.fn.dropArea=function(){return this.bind("dragenter",dragEnter).bind("dragover",dragOver).bind("dragleave",dragLeave),this},$.fn.noDropArea=function(){return this.unbind("dragenter").unbind("dragover").unbind("dragleave"),this},$.fn.caretToEnd=function(){var range,selection;return range=document.createRange(),range.selectNodeContents(this[0]),range.collapse(!1),selection=window.getSelection(),selection.removeAllRanges(),selection.addRange(range),this}},{}],172:[function(require,module){"use strict";module.exports=function(protoProps,staticProps){var child,parent=this;child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},Object.assign(child,parent,staticProps);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&Object.assign(child.prototype,protoProps),child.__super__=parent.prototype,child}},{}],173:[function(require,module){"use strict";var _=require("./lodash");require("es6-shim"),require("./helpers/event"),require("./vendor/array-includes");var utils=require("./utils"),SirTrevor={config:require("./config"),log:utils.log,Locales:require("./locales"),Events:require("./events"),EventBus:require("./event-bus"),EditorStore:require("./extensions/editor-store"),Submittable:require("./extensions/submittable"),FileUploader:require("./extensions/file-uploader"),BlockMixins:require("./block_mixins"),BlockPositioner:require("./block-positioner"),BlockReorder:require("./block-reorder"),BlockDeletion:require("./block-deletion"),BlockValidations:require("./block-validations"),BlockStore:require("./block-store"),BlockManager:require("./block-manager"),SimpleBlock:require("./simple-block"),Block:require("./block"),Blocks:require("./blocks"),BlockControl:require("./block-control"),BlockControls:require("./block-controls"),FloatingBlockControls:require("./floating-block-controls"),FormatBar:require("./format-bar"),Editor:require("./editor"),toMarkdown:require("./to-markdown"),toHTML:require("./to-html"),setDefaults:function(options){Object.assign(SirTrevor.config.defaults,options||{})},getInstance:utils.getInstance,setBlockOptions:function(type,options){var block=SirTrevor.Blocks[type];_.isUndefined(block)||Object.assign(block.prototype,options||{})},runOnAllInstances:function(method){if(SirTrevor.Editor.prototype.hasOwnProperty(method)){var methodArgs=Array.prototype.slice.call(arguments,1);Array.prototype.forEach.call(SirTrevor.config.instances,function(i){i[method].apply(null,methodArgs)})}else SirTrevor.log("method doesn't exist")}};Object.assign(SirTrevor,require("./form-events")),module.exports=SirTrevor},{"./block":143,"./block-control":135,"./block-controls":136,"./block-deletion":137,"./block-manager":138,"./block-positioner":139,"./block-reorder":140,"./block-store":141,"./block-validations":142,"./block_mixins":148,"./blocks":153,"./config":159,"./editor":160,"./event-bus":162,"./events":163,"./extensions/editor-store":164,"./extensions/file-uploader":165,"./extensions/submittable":166,"./floating-block-controls":167,"./form-events":168,"./format-bar":169,"./helpers/event":171,"./locales":174,"./lodash":175,"./simple-block":178,"./to-html":179,"./to-markdown":180,"./utils":181,"./vendor/array-includes":182,"es6-shim":2}],174:[function(require,module){"use strict";var _=require("./lodash"),config=require("./config"),utils=require("./utils"),Locales={en:{general:{"delete":"Delete?",drop:"Drag __block__ here",paste:"Or paste URL here",upload:"...or choose a file",close:"close",position:"Position",wait:"Please wait...",link:"Enter a link"},errors:{title:"You have the following errors:",validation_fail:"__type__ block is invalid",block_empty:"__name__ must not be empty",type_missing:"You must have a block of type __type__",required_type_empty:"A required block type __type__ is empty",load_fail:"There was a problem loading the contents of the document"},blocks:{text:{title:"Text"},list:{title:"List"},quote:{title:"Quote",credit_field:"Credit"},image:{title:"Image",upload_error:"There was a problem with your upload"},video:{title:"Video"},tweet:{title:"Tweet",fetch_error:"There was a problem fetching your tweet"},embedly:{title:"Embedly",fetch_error:"There was a problem fetching your embed",key_missing:"An Embedly API key must be present"},heading:{title:"Heading"}}}};void 0===window.i18n?(utils.log("Using i18n stub"),window.i18n={t:function(key,options){var str,obj,part,i,parts=key.split(":");for(obj=Locales[config.language],i=0;i<parts.length;i++)part=parts[i],_.isUndefined(obj[part])||(obj=obj[part]);return str=obj,_.isString(str)?(str.indexOf("__")>=0&&Object.keys(options).forEach(function(opt){str=str.replace("__"+opt+"__",options[opt])}),str):""}}):(utils.log("Using i18next"),i18n.init({resStore:Locales,fallbackLng:config.language,ns:{namespaces:["general","blocks"],defaultNs:"general"}})),module.exports=Locales},{"./config":159,"./lodash":175,"./utils":181}],175:[function(require,module,exports){"use strict";exports.isEmpty=require("lodash.isempty"),exports.isFunction=require("lodash.isfunction"),exports.isObject=require("lodash.isobject"),exports.isString=require("lodash.isstring"),exports.isUndefined=require("lodash.isundefined"),exports.result=require("lodash.result"),exports.template=require("lodash.template"),exports.uniqueId=require("lodash.uniqueid")},{"lodash.isempty":5,"lodash.isfunction":29,"lodash.isobject":30,"lodash.isstring":32,"lodash.isundefined":33,"lodash.result":34,"lodash.template":35,"lodash.uniqueid":51}],176:[function(require,module){"use strict";module.exports={mediatedEvents:{},eventNamespace:null,_bindMediatedEvents:function(){Object.keys(this.mediatedEvents).forEach(function(eventName){var cb=this.mediatedEvents[eventName];eventName=this.eventNamespace?this.eventNamespace+":"+eventName:eventName,this.mediator.on(eventName,this[cb].bind(this))},this)}}},{}],177:[function(require,module){"use strict";var _=require("./lodash");module.exports={tagName:"div",className:"sir-trevor__view",attributes:{},$:function(selector){return this.$el.find(selector)},render:function(){return this},destroy:function(){_.isUndefined(this.stopListening)||this.stopListening(),this.$el.remove()},_ensureElement:function(){if(this.el)this._setElement(this.el);else{var html,attrs=Object.assign({},_.result(this,"attributes"));this.id&&(attrs.id=this.id),this.className&&(attrs["class"]=this.className),attrs.html&&(html=attrs.html,delete attrs.html);var $el=$("<"+this.tagName+">").attr(attrs);html&&$el.html(html),this._setElement($el)}},_setElement:function(element){return this.$el=$(element),this.el=this.$el[0],this}}},{"./lodash":175}],178:[function(require,module){"use strict";var _=require("./lodash"),utils=require("./utils"),BlockReorder=require("./block-reorder"),SimpleBlock=function(data,instance_id,mediator,options){this.createStore(data),this.blockID=_.uniqueId("st-block-"),this.instanceID=instance_id,this.mediator=mediator,this.options=options||{},this._ensureElement(),this._bindFunctions(),this.initialize.apply(this,arguments)};Object.assign(SimpleBlock.prototype,require("./function-bind"),require("./events"),require("./renderable"),require("./block-store"),{focus:function(){},valid:function(){return!0},className:"st-block",block_template:_.template("<div class='st-block__inner'><%= editor_html %></div>"),attributes:function(){return{id:this.blockID,"data-type":this.type,"data-instance":this.instanceID}},title:function(){return utils.titleize(this.type.replace(/[\W_]/g," "))},blockCSSClass:function(){return this.blockCSSClass=utils.toSlug(this.type),this.blockCSSClass},type:"","class":function(){return utils.classify(this.type)},editorHTML:"",initialize:function(){},onBlockRender:function(){},beforeBlockRender:function(){},_setBlockInner:function(){var editor_html=_.result(this,"editorHTML");this.$el.append(this.block_template({editor_html:editor_html})),this.$inner=this.$el.find(".st-block__inner"),this.$inner.bind("click mouseover",function(e){e.stopPropagation()})},render:function(){return this.beforeBlockRender(),this._setBlockInner(),this._blockPrepare(),this},_blockPrepare:function(){this._initUI(),this._initMessages(),this.checkAndLoadData(),this.$el.addClass("st-item-ready"),this.on("onRender",this.onBlockRender),this.save()},_withUIComponent:function(component,className,callback){this.$ui.append(component.render().$el),className&&callback&&this.$ui.on("click",className,callback)},_initUI:function(){var ui_element=$("<div>",{"class":"st-block__ui"});this.$inner.append(ui_element),this.$ui=ui_element,this._initUIComponents()},_initMessages:function(){var msgs_element=$("<div>",{"class":"st-block__messages"});this.$inner.prepend(msgs_element),this.$messages=msgs_element},addMessage:function(msg,additionalClass){var $msg=$("<span>",{html:msg,"class":"st-msg "+additionalClass});return this.$messages.append($msg).addClass("st-block__messages--is-visible"),$msg},resetMessages:function(){this.$messages.html("").removeClass("st-block__messages--is-visible")},_initUIComponents:function(){this._withUIComponent(new BlockReorder(this.$el))}}),SimpleBlock.fn=SimpleBlock.prototype,SimpleBlock.extend=require("./helpers/extend"),module.exports=SimpleBlock},{"./block-reorder":140,"./block-store":141,"./events":163,"./function-bind":170,"./helpers/extend":172,"./lodash":175,"./renderable":177,"./utils":181}],179:[function(require,module){"use strict";var _=require("./lodash"),utils=require("./utils");module.exports=function(markdown,type){var Blocks=require("./blocks");type=utils.classify(type);var html=markdown,shouldWrap="Text"===type;_.isUndefined(shouldWrap)&&(shouldWrap=!1),shouldWrap&&(html="<div>"+html),html=html.replace(/\[([^\]]+)\]\(([^\)]+)\)/gm,function(match,p1,p2){return"<a href='"+p2+"'>"+p1.replace(/\n/g,"")+"</a>"
}),html=utils.reverse(utils.reverse(html).replace(/_(?!\\)((_\\|[^_])*)_(?=$|[^\\])/gm,function(match,p1){return">i/<"+p1.replace(/\n/g,"").replace(/[\s]+$/,"")+">i<"}).replace(/\*\*(?!\\)((\*\*\\|[^\*\*])*)\*\*(?=$|[^\\])/gm,function(match,p1){return">b/<"+p1.replace(/\n/g,"").replace(/[\s]+$/,"")+">b<"})),html=html.replace(/^\> (.+)$/gm,"$1");var block;return Blocks.hasOwnProperty(type)&&(block=Blocks[type],!_.isUndefined(block.prototype.toHTML)&&_.isFunction(block.prototype.toHTML)&&(html=block.prototype.toHTML(html))),shouldWrap&&(html=html.replace(/\n\n/gm,"</div><div><br></div><div>"),html=html.replace(/\n/gm,"</div><div>")),html=html.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\n/g,"<br>").replace(/\*\*/,"").replace(/__/,""),html=html.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\-/g,"-"),shouldWrap&&(html+="</div>"),html}},{"./blocks":153,"./lodash":175,"./utils":181}],180:[function(require,module){"use strict";var _=require("./lodash"),utils=require("./utils");module.exports=function(content,type){function replaceBolds(match,p1,p2){return _.isUndefined(p2)&&(p2=""),"**"+p1.replace(/<(.)?br(.)?>/g,"")+"**"+p2}function replaceItalics(match,p1,p2){return _.isUndefined(p2)&&(p2=""),"_"+p1.replace(/<(.)?br(.)?>/g,"")+"_"+p2}var Blocks=require("./blocks");type=utils.classify(type);var markdown=content;markdown=markdown.replace(/&nbsp;/g," "),markdown=markdown.replace(/( class=(")?Mso[a-zA-Z]+(")?)/g,"").replace(/<!--(.*?)-->/g,"").replace(/\/\*(.*?)\*\//g,"").replace(/<(\/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>/gi,"");var tagStripper,i,badTags=["style","script","applet","embed","noframes","noscript"];for(i=0;i<badTags.length;i++)tagStripper=new RegExp("<"+badTags[i]+".*?"+badTags[i]+"(.*?)>","gi"),markdown=markdown.replace(tagStripper,"");markdown=markdown.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\-/g,"\\-");var inlineTags=["em","i","strong","b"];for(i=0;i<inlineTags.length;i++)tagStripper=new RegExp("<"+inlineTags[i]+"><br></"+inlineTags[i]+">","gi"),markdown=markdown.replace(tagStripper,"<br>");markdown=markdown.replace(/<(\w+)(?:\s+\w+="[^"]+(?:"\$[^"]+"[^"]+)?")*>\s*<\/\1>/gim,"").replace(/\n/gm,"").replace(/<a.*?href=[""'](.*?)[""'].*?>(.*?)<\/a>/gim,function(match,p1,p2){return"["+p2.trim().replace(/<(.)?br(.)?>/g,"")+"]("+p1+")"}).replace(/<strong>(?:\s*)(.*?)(\s)*?<\/strong>/gim,replaceBolds).replace(/<b>(?:\s*)(.*?)(\s*)?<\/b>/gim,replaceBolds).replace(/<em>(?:\s*)(.*?)(\s*)?<\/em>/gim,replaceItalics).replace(/<i>(?:\s*)(.*?)(\s*)?<\/i>/gim,replaceItalics),markdown=markdown.replace(/([^<>]+)(<div>)/g,"$1\n$2").replace(/<div><div>/g,"\n<div>").replace(/(?:<div>)([^<>]+)(?:<div>)/g,"$1\n").replace(/(?:<div>)(?:<br>)?([^<>]+)(?:<br>)?(?:<\/div>)/g,"$1\n").replace(/<\/p>/g,"\n\n").replace(/<(.)?br(.)?>/g,"\n").replace(/&lt;/g,"<").replace(/&gt;/g,">");var block;return Blocks.hasOwnProperty(type)&&(block=Blocks[type],!_.isUndefined(block.prototype.toMarkdown)&&_.isFunction(block.prototype.toMarkdown)&&(markdown=block.prototype.toMarkdown(markdown))),markdown=markdown.replace(/<\/?[^>]+(>|$)/g,"")}},{"./blocks":153,"./lodash":175,"./utils":181}],181:[function(require,module){"use strict";var _=require("./lodash"),config=require("./config"),urlRegex=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,utils={getInstance:function(identifier){return _.isUndefined(identifier)?config.instances[0]:_.isString(identifier)?config.instances.find(function(editor){return editor.ID===identifier}):config.instances[identifier]},getInstanceBySelection:function(){return utils.getInstance($(window.getSelection().anchorNode).parents(".st-block").data("instance"))},getBlockBySelection:function(){return utils.getInstanceBySelection().findBlockById($(window.getSelection().anchorNode).parents(".st-block").get(0).id)},log:function(){!_.isUndefined(console)&&config.debug&&console.log.apply(console,arguments)},isURI:function(string){return urlRegex.test(string)},titleize:function(str){return null===str?"":(str=String(str).toLowerCase(),str.replace(/(?:^|\s|-)\S/g,function(c){return c.toUpperCase()}))},classify:function(str){return utils.titleize(String(str).replace(/[\W_]/g," ")).replace(/\s/g,"")},capitalize:function(string){return string.charAt(0).toUpperCase()+string.substring(1).toLowerCase()},flatten:function(obj){var x={};return(Array.isArray(obj)?obj:Object.keys(obj)).forEach(function(i){x[i]=!0}),x},underscored:function(str){return str.trim().replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},reverse:function(str){return str.split("").reverse().join("")},toSlug:function(str){return str.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}};module.exports=utils},{"./config":159,"./lodash":175}],182:[function(){"use strict";[].includes||(Array.prototype.includes=function(searchElement){if(void 0===this||null===this)throw new TypeError("Cannot convert this value to object");var O=Object(this),len=parseInt(O.length)||0;if(0===len)return!1;var k,n=parseInt(arguments[1])||0;for(n>=0?k=n:(k=len+n,0>k&&(k=0));len>k;){var currentElement=O[k];if(searchElement===currentElement||searchElement!==searchElement&&currentElement!==currentElement)return!0;k++}return!1})},{}]},{},[1])(1)});